(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-12495319"],{"32fe":function(e,t,a){},4468:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-upload",{ref:"upload",attrs:{action:e.BASE_API+e.url,headers:e.headers,limit:1,"auto-upload":!1,"show-file-list":!1,data:e.data,accept:e.accept,"on-change":e.onChangeFile}},[e.avatar?i("img",{staticStyle:{height:"100px",border:"dashed 1px #ccc","border-radius":"7px"},attrs:{src:e.avatar}}):e._e(),e.avatar?e._e():i("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:a("d1da")}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.tips||e.accept,expression:"tips || accept"}],staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.tips?e.tips:"仅支持"+e.accept+"格式"))])])},l=[],s={name:"",components:{},props:{avatar:{type:String,default:function(){return""}},url:{type:String,default:function(){return"/file"}},tag:{type:String,default:function(){return""}},accept:{type:String,default:function(){return""}},tips:{type:String,default:function(){return""}}},data:function(){return{BASE_API:"https://dev-api.cgvcap.com",headers:{Authorization:"Bearer "+this.$store.state.user.user.token},data:{}}},methods:{onChangeFile:function(e){e.response&&200===e.response.code&&e.response.data?(this.$emit("UPLOAD_AVATAR",e.response.data),this.$refs.upload.clearFiles()):(this.$set(this.data,this.tag,e.raw),this.$refs.upload.submit())}}},r=s,n=a("4ac2"),o=Object(n["a"])(r,i,l,!1,null,"7086ef7a",null);t["a"]=o.exports},"79c5":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.dialogVisible,width:"850px","append-to-body":!0,"show-close":!1,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"title"},[a("i",{staticClass:"iconfont icon-hangyepeizhi"}),e._v(" "+e._s(e.edit?"编辑":"添加")+"行研\n      ")]),a("div",{staticClass:"options",staticStyle:{display:"flex","align-items":"center"}},[e.isApproval?a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submit("RA")}}},[e._v("提交")]):e._e(),a("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){return e.hideDialog()}}})],1),a("div",{staticClass:"clear"})]),a("div",{staticClass:"main-wrap"},[a("el-scrollbar",{style:{height:e.height}},[a("el-form",{ref:"detail",attrs:{model:e.detail,"label-width":"110px"}},[a("div",{staticClass:"wrap"},[a("div",{staticClass:"form-content",staticStyle:{"margin-top":"15px"}},[a("el-form-item",{attrs:{label:"主题",prop:"industrySubject",rules:{required:!0,message:"请输入主题"}}},[a("el-input",{attrs:{placeholder:"",disabled:e.edit&&!e.isApproval},model:{value:e.detail.industrySubject,callback:function(t){e.$set(e.detail,"industrySubject",t)},expression:"detail.industrySubject"}})],1),a("div",{staticStyle:{float:"left",width:"49%"}},[a("el-form-item",{attrs:{label:"一级行业",prop:"lvl1Industry",rules:{required:!0,message:"请选择一级行业"}}},[a("el-select",{staticStyle:{width:"100%"},attrs:{prop:"lvl1Industry",placeholder:"",disabled:e.edit&&!e.isApproval},on:{change:function(t){return e.getIndustryG2List()}},model:{value:e.detail.lvl1Industry,callback:function(t){e.$set(e.detail,"lvl1Industry",t)},expression:"detail.lvl1Industry"}},e._l(e.enumType.IndustryG1List,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"负责人",prop:"principal",rules:{required:!0,message:"请选择负责人"}}},[a("user-select",{attrs:{multi:!1,users:e.detail.principal},on:{SET_USERS:function(t){e.detail.principal=t}}})],1)],1),a("div",{staticStyle:{float:"left",width:"49%","margin-left":"2%"}},[a("el-form-item",{attrs:{label:"二级行业",prop:"lvl2Industry",rules:{required:!0,message:"请选择二级行业"}}},[a("el-select",{staticStyle:{width:"100%"},attrs:{prop:"lvl2Industry",placeholder:"",disabled:e.edit&&!e.isApproval},model:{value:e.detail.lvl2Industry,callback:function(t){e.$set(e.detail,"lvl2Industry",t)},expression:"detail.lvl2Industry"}},e._l(e.enumType.IndustryG2List,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"参与人",prop:"users",rules:{required:!0,message:"请选择参与人"}}},[a("user-select",{attrs:{users:e.detail.users},on:{SET_USERS:function(t){e.detail.users=t}}})],1)],1),a("div",{staticClass:"clear"}),a("el-form-item",{attrs:{label:"关联企业",prop:"enterpriseName",rules:{required:!0,message:"请选择关联企业"}}},[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("el-select",{ref:"enterprise",staticStyle:{width:"640px"},attrs:{multiple:"",filterable:"","reserve-keyword":"",placeholder:"请输入关键词",loading:e.enterprise.loading,"filter-method":e.filterMethod},model:{value:e.detail.enterpriseName,callback:function(t){e.$set(e.detail,"enterpriseName",t)},expression:"detail.enterpriseName"}},e._l(e.enterprise.list,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1),a("el-button",{staticStyle:{color:"#3f6eb8"},attrs:{type:"text",disaled:e.enterprise.loading},on:{click:e.searchEnterprise}},[e._v("查询\n                  ")])],1)]),e.edit?e._e():a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"计划完成时间",prop:"planCompleteTime",rules:{required:!0,message:"请选择计划完成时间"}}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.detail.planCompleteTime,callback:function(t){e.$set(e.detail,"planCompleteTime",t)},expression:"detail.planCompleteTime"}})],1),e.edit&&!e.isApproval?a("div",{staticStyle:{float:"left",width:"49%"}},[e.edit?a("el-form-item",{attrs:{label:"进度（%）",prop:"progress",rules:{required:!0,message:"请输入进度"}}},[a("el-input",{attrs:{placeholder:"",type:"number"},model:{value:e.detail.progress,callback:function(t){e.$set(e.detail,"progress",t)},expression:"detail.progress"}})],1):e._e(),a("el-form-item",{attrs:{label:"行研状态"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:""},model:{value:e.detail.manageState,callback:function(t){e.$set(e.detail,"manageState",t)},expression:"detail.manageState"}},e._l(e.enumType.IndustryResearchManageState,(function(e){return a("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})})),1)],1)],1):e._e(),e.edit&&!e.isApproval?a("div",{staticStyle:{float:"left",width:"49%","margin-left":"2%"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"计划完成时间",prop:"planCompleteTime",rules:{required:!0,message:"请选择计划完成时间"}}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.detail.planCompleteTime,callback:function(t){e.$set(e.detail,"planCompleteTime",t)},expression:"detail.planCompleteTime"}})],1),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"实际完成时间",prop:"completeTime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.detail.completeTime,callback:function(t){e.$set(e.detail,"completeTime",t)},expression:"detail.completeTime"}})],1)],1):e._e(),a("div",{staticClass:"clear"}),e.edit&&!e.isApproval?a("el-form-item",{attrs:{label:"进度描述",prop:"progressDesc"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:6},placeholder:"请输入内容"},model:{value:e.detail.progressDesc,callback:function(t){e.$set(e.detail,"progressDesc",t)},expression:"detail.progressDesc"}})],1):e._e(),!e.edit||e.isApproval?a("el-form-item",{attrs:{label:"封面图",prop:"coverImg",rules:{required:!0,message:"请上传封面图"}}},[a("avatar-upload",{attrs:{avatar:e.detail.coverImg,url:"/invest/industryResearch/coverImg/upload",tag:"coverImg",accept:".jpg,.png",tips:"封面图仅支持 jpg、png格式图片，建议图片尺寸为400*250px，大小512KB以内。"},on:{UPLOAD_AVATAR:function(t){e.detail.coverImg=t}}})],1):e._e()],1)]),!e.edit||e.isApproval?a("div",{staticClass:"wrap"},[a("div",{staticClass:"tips-title"},[e._v("\n              流程审批\n            ")]),a("div",[a("approve",{ref:"approve",attrs:{detail:e.approval,valid:e.approval.valid},on:{VALID:function(t){e.approval.valid=t},SET_CC_USERS:function(t){e.approval.ccUsers=t},SET_APPROVAL_NODES:function(t){e.approval.approvalNodes=t}}})],1)]):e._e(),e.edit&&!e.isApproval?a("div",{staticClass:"wrap"},[a("div",{staticClass:"tips-title"},[e._v("\n              行研文件\n            ")]),a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("el-form-item",{staticStyle:{width:"30%"},attrs:{label:"","label-width":"0",prop:"coverImg",rules:{required:!0,message:"请上传封面图"}}},[a("div",{staticClass:"wrap"},[a("div",{staticClass:"tips-title"},[e._v("\n                    封面图\n                  ")]),a("avatar-upload",{attrs:{avatar:e.detail.coverImg,url:"/invest/industryResearch/coverImg/upload",tag:"coverImg",accept:".jpg,.png",tips:"封面图仅支持 jpg、png格式图片，建议图片尺寸为400*250px，大小512KB以内。"},on:{UPLOAD_AVATAR:function(t){e.detail.coverImg=t}}})],1)]),a("div",{staticStyle:{width:"70%"}},[a("div",{staticClass:"wrap"},[a("div",{staticClass:"tips-title"},[e._v("\n                    主文件（行研报告）\n                    "),a("div",{staticClass:"button"},[a("file-upload",{attrs:{icon:"icon",files:e.detail.attachment,list:!1,tag:"research"},on:{UPLOAD_FILE:function(t){e.detail.attachment=t}}})],1)]),a("div",{staticClass:"form-content",staticStyle:{"margin-top":"15px"}},[a("file-upload",{attrs:{icon:"none",files:e.detail.attachment}})],1)]),a("div",{staticClass:"wrap"},[a("div",{staticClass:"tips-title"},[e._v("\n                    副文件（参考文献）\n                    "),a("div",{staticClass:"button"},[a("file-upload",{attrs:{icon:"icon",files:e.detail.subFiles,list:!1,tag:"research"},on:{UPLOAD_FILE:function(t){e.detail.subFiles=t}}})],1)]),a("div",{staticClass:"form-content",staticStyle:{"margin-top":"15px"}},[a("file-upload",{attrs:{icon:"none",files:e.detail.subFiles}})],1)])])],1)]):e._e(),e.isApproval?e._e():a("div",{staticClass:"wrap"},[a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.submit("CA")}}},[e._v(e._s(e.edit?"确定":"提交"))]),a("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"",size:"small"},on:{click:function(t){return e.hideDialog()}}},[e._v("取消")])],1)])],1)],1)])},l=[],s=a("b62b"),r=a("7218"),n=a("328f"),o=a("4468"),d=a("d278"),p={name:"",components:{fileUpload:r["a"],userSelect:n["a"],avatarUpload:o["a"],approve:d["default"]},props:{id:{type:String,default:function(){return""}},templateCode:{type:String,default:function(){return"DD01"}}},data:function(){return{edit:!1,isApproval:!1,nodeInstanceId:"",enumType:{IndustryG1List:[],IndustryG2List:[]},dialogVisible:!1,detail:{lvl2Industry:"",principal:[],users:[],coverImg:""},height:"",formTemplates:[],enterprise:{filter:"",list:[],loading:!1,planCompleteTime:"",enterpriseName:[]},approval:{valid:!1,approvalNodes:[],ccUsers:[],urgencyLvl:""},approvalDetail:{},pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e4}}}},mounted:function(){this.height=document.body.clientHeight-200+"px",this.getEnum("InvestWay"),this.getEnum("IndustryResearchManageState"),this.getEnum("ProjectFundSource"),this.getEnum("InvestCcy"),this.getEnum("ProjectFundSource"),this.getIndustryList()},methods:{getEnum:function(e,t){var a=this;s["a"].getEnum(e).then((function(i){200===i.code&&(t&&i.data.unshift({name:"全部",value:""}),a.$set(a.enumType,e,i.data))})).catch((function(e){console.log(e)}))},show:function(e,t,a){if(this.isApproval=t||!1,this.approvalDetail=a,e){if(this.edit=!0,this.initParamsByDraft(e),this.isApproval){var i=[];a.approvalNodes.map((function(e){e.nodeType&&"CN"!==e.nodeType.value&&i.push({userName:e.approvalUser&&e.approvalUser.userName||e.nodeName,nodeRefId:e.approvalUser&&e.approvalUser.userId,nodeId:e.nodeInstanceId,nodeType:e.nodeType&&e.nodeType.value,userId:e.nodeRefId||e.id,userTag:e.nodeName,nodeName:e.nodeName})})),this.approval={valid:!1,approvalNodes:i,approvalType:{value:"FX"},ccUsers:a.ccUsers,urgencyLvl:a.urgencyLvl.value}}}else this.edit=!1,this.initParams()},initParams:function(){var e=this;s["a"].getApproveInit("IS01").then((function(t){t&&200===t.code&&(e.dialogVisible=!0,e.approval={approvalType:t.data.approvalType,approvalNodes:t.data.approvalNodes.map((function(e){return{userName:e.approvalUser&&e.approvalUser.userName||e.nodeName,nodeRefId:e.approvalUser.userId,nodeId:e.nodeInstanceId,nodeType:e.nodeType.value||"UN",userId:e.nodeRefId||e.id,userTag:e.nodeName}})),ccUsers:t.data.ccUsers,urgencyLvl:t.data.urgencyLvl.value},e.isApproval||(e.detail={lvl1Industry:"",lvl2Industry:"",principal:[],users:[],enterpriseName:[],coverImg:""},e.dialogVisible=!0,setTimeout((function(){e.clearValidateField()}),300)))}))},initParamsByDraft:function(e){var t=this;s["a"].getIndustryResearch(e).then((function(a){200===a.code&&(a.data.id=e,a.data.principal=[a.data.principal],a.data.manageState=a.data.manageState?a.data.manageState.value:"",a.data.users=a.data.users||[],a.data.lvl1Industry=a.data.lvl1IndustryId,a.data.lvl2Industry=a.data.lvl2IndustryId,a.data.attachment=a.data.attachment||[],a.data.planCompleteTime=t.$options.filters["DateTimeEn"](a.data.planCompleteTime),a.data.completeTime=t.$options.filters["DateTimeEn"](a.data.completeTime),a.data.coverImg=a.data.coverImg||"",t.getIndustryG2List(!0),t.detail=a.data,t.dialogVisible=!0)})).catch((function(e){console.log(e)}))},hideDialog:function(){this.$refs["detail"].clearValidate(),this.dialogVisible=!1},submit:function(e){this.edit&&!this.isApproval?this.editResearch():this.createResearch(e)},createResearch:function(e){var t=this;this.$refs["detail"].validate((function(a){if(a){var i={approvalId:t.isApproval?t.approvalDetail.approvalId:"",templateCode:"IS01",submitType:e,approvalTitle:"",urgencyLvl:t.approval.urgencyLvl,bizForm:{enterpriseName:t.detail.enterpriseName,industrySubject:t.detail.industrySubject,lvl1Industry:t.detail.lvl1Industry,lvl2Industry:t.detail.lvl2Industry,planCompleteTime:t.detail.planCompleteTime,principalId:t.detail.principal[0].id||t.detail.principal[0].userId,coverImg:t.detail.coverImg,userIds:function(){var e=[];return t.detail.users.map((function(t){e.push(t.id||t.userId)})),e}()}};"FE"!==t.approval.approvalType.value||t.isApproval||(i.approvalNodes=t.approval.approvalNodes),t.isApproval&&(i.approvalNodes=t.approval.approvalNodes,i.resubmitOpt={nodeInstanceId:t.approvalDetail.currentNode.nodeInstanceId,strategy:"RN"}),s["a"].createResearch(i).then((function(e){200===e.code&&(t.$message.success({message:"行研提交成功！",duration:1500}),t.$emit("REFRESH"),t.dialogVisible=!1)})).catch((function(e){console.log(e)}))}}))},editResearch:function(){var e=this;this.$refs["detail"].validate((function(t){if(t){var a={coverImg:e.detail.coverImg,enterpriseName:e.detail.enterpriseName,industrySubject:e.detail.industrySubject,lvl1Industry:e.detail.lvl1Industry,lvl2Industry:e.detail.lvl2Industry,principalId:e.detail.principal[0].id||e.detail.principal[0].userId,progress:e.detail.progress,progressDesc:e.detail.progressDesc,planCompleteTime:e.detail.planCompleteTime,completeTime:e.detail.completeTime,manageState:e.detail.manageState,userIds:function(){var t=[];return e.detail.users.map((function(e){t.push(e.id||e.userId)})),t}()};for(var i in e.detail.attachment)a["attachment["+i+"].accessCode"]=e.detail.attachment[i].accessCode,a["attachment["+i+"].fileId"]=e.detail.attachment[i].fileId,a["attachment["+i+"].fileName"]=e.detail.attachment[i].fileName,e.detail.attachment[i].attachId&&(a["attachment["+i+"].attachId"]=e.detail.attachment[i].attachId);for(var l in e.detail.subFiles)a["subFiles["+l+"].accessCode"]=e.detail.subFiles[l].accessCode,a["subFiles["+l+"].fileId"]=e.detail.subFiles[l].fileId,a["subFiles["+l+"].fileName"]=e.detail.subFiles[l].fileName,e.detail.subFiles[l].attachId&&(a["subFiles["+l+"].attachId"]=e.detail.subFiles[l].attachId);s["a"].editIndustryResearch(a,e.detail.id).then((function(t){200===t.code&&(e.$message.success({message:"行研编辑成功！",duration:1500}),e.dialogVisible=!1,e.$emit("REFRESH"))})).catch((function(e){console.log(e)}))}}))},clearValidateField:function(){this.$refs.approve.clearValidateField()},getIndustryList:function(){var e=this,t={configureState:"UP",level:"G1",pageNum:1,pageSize:100};s["a"].getIndustryConfigurationList(t).then((function(t){200===t.code&&(t.data.list.map((function(e){e.name=e.industryName,e.value=e.industryId})),e.enumType.IndustryG1List=t.data.list)})).catch((function(e){console.log(e)}))},getIndustryG2List:function(e){var t=this,a={level:"G2",superiorId:this.detail.lvl1Industry};e||this.$set(this.detail,"lvl2Industry",""),s["a"].getIndustryG2List(a).then((function(e){200===e.code&&(e.data.map((function(e){e.name=e.industryName,e.value=e.industryId})),t.enumType.IndustryG2List=e.data)})).catch((function(e){console.log(e)}))},filterMethod:function(e){e&&(this.enterprise.filter=e)},getEnterpriseList:function(){var e=this;if(this.enterprise.loading){var t={entName:this.enterprise.filter};s["a"].getTYCEnterprise(t).then((function(t){200===t.code&&(e.enterprise.list=t.data||[],e.$refs.enterprise.focus(),e.enterprise.filter="",e.enterprise.loading=!1)})).catch((function(e){console.log(e)}))}},searchEnterprise:function(){this.enterprise.loading=!0,this.getEnterpriseList()}}},c=p,u=(a("dc56"),a("8dbc"),a("4ac2")),m=Object(u["a"])(c,i,l,!1,null,"3e2d4a03",null);t["default"]=m.exports},"8dbc":function(e,t,a){"use strict";a("32fe")},d278:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"detail",attrs:{model:e.detail,"label-width":"140px"}},[a("el-form-item",{attrs:{label:"审批人"}},[a("user-select",{attrs:{users:e.detail.approvalNodes,edit:e.detail.approvalType&&"FX"!==e.detail.approvalType.value,step:!0},on:{SET_USERS:e.setApprovalNodes}})],1),e.detail.approvalType&&"FX"===e.detail.approvalType.value&&e.detail.ccUsers&&0===e.detail.ccUsers.length?e._e():a("el-form-item",{attrs:{label:"抄送人"}},[a("user-select",{attrs:{users:e.detail.ccUsers,edit:e.detail.approvalType&&"FX"!==e.detail.approvalType.value},on:{SET_USERS:e.setCcUsers}})],1),a("el-form-item",{attrs:{label:"紧急程度",prop:"urgencyLvl",rules:{required:!0,message:"请选择紧急程度"}}},e._l(e.enumType.UrgencyLevel,(function(t,i){return a("el-radio",{key:i,attrs:{label:t.value},model:{value:e.detail.urgencyLvl,callback:function(t){e.$set(e.detail,"urgencyLvl",t)},expression:"detail.urgencyLvl"}},[e._v(e._s(t.name))])})),1)],1)},l=[],s=a("328f"),r=a("b62b"),n={name:"",components:{userSelect:s["a"]},props:{detail:Object,valid:{type:Boolean,default:function(){return!1}}},data:function(){return{enumType:{}}},mounted:function(){this.getEnum("UrgencyLevel")},methods:{getEnum:function(e,t){var a=this;r["a"].getEnum(e).then((function(i){200===i.code&&(t&&i.data.unshift({name:"全部",value:""}),a.$set(a.enumType,e,i.data))})).catch((function(e){console.log(e)}))},setCcUsers:function(e){this.$emit("SET_CC_USERS",e)},setApprovalNodes:function(e){for(var t in e)e[t].nodeRefId=e[t].nodeRefId||e[t].id||e[t].userId,e[t].nodeType=e[t].nodeType||"UN",e[t].userId=e[t].nodeRefId||e[t].id,e[t].userTag=e[t].userTag||"审批人",e[t].nodeName=e[t].userTag||"审批人";console.log(e),this.$emit("SET_APPROVAL_NODES",e)},validateField:function(){var e=this;return this.$refs.detail.validate((function(t){e.$emit("VALID",t)}))},clearValidateField:function(){this.$refs.detail.clearValidate()}}},o=n,d=a("4ac2"),p=Object(d["a"])(o,i,l,!1,null,"f5a59ec0",null);t["default"]=p.exports},dc56:function(e,t,a){"use strict";a("e004")},e004:function(e,t,a){}}]);