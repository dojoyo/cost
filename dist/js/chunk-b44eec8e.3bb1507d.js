(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b44eec8e"],{"0d7a":function(e,t,s){},"1f77":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"target-wrap",attrs:{visible:e.dialogVisible,width:"850px",top:"50px","show-close":!1,"append-to-body":e.append,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticClass:"header",attrs:{slot:"title",id:"dialog"},slot:"title"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-fenlei primary"}),e._v(" "+e._s(e.target.period&&e.target.period.periodName)+"\n    ")]),s("div",{staticClass:"options"},[s("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.target.privileges&&e.target.privileges.editObj,expression:"target.privileges && target.privileges.editObj"}],staticClass:"item",attrs:{effect:"dark",content:"编辑目标",placement:"top"}},[s("i",{staticClass:"iconfont icon-bianji pointer fs-22 mr-10",on:{click:function(t){return e.editTarget()}}})]),s("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.target.privileges&&e.target.privileges.closeObj,expression:"target.privileges && target.privileges.closeObj"}],staticClass:"item",attrs:{effect:"dark",content:"结束目标",placement:"top"}},[s("i",{staticClass:"iconfont icon-jieshu pointer fs-22 mr-10",on:{click:function(t){return e.getScoreInfo()}}})]),s("el-tooltip",{directives:[{name:"show",rawName:"v-show",value:e.target.privileges&&e.target.privileges.deleteObj,expression:"target.privileges && target.privileges.deleteObj"}],staticClass:"item",attrs:{effect:"dark",content:"删除目标",placement:"top"}},[s("i",{staticClass:"iconfont icon-delete pointer fs-22 mr-10",on:{click:function(t){return e.deleteTarget()}}})]),s("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.dialogVisible=!1}}})],1),s("div",{staticClass:"clear"})]),e.target.objParent?s("el-row",[s("el-col",{attrs:{span:24}},[s("i",{staticClass:"iconfont icon-home mr-10"}),e._v("父目标："+e._s(e.target.objParent&&e.target.objParent.objName)+"     进度"+e._s(e.target.objParent?e.target.objParent.objProgress.progress:0)+"%")])],1):e._e(),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:15}},[s("i",{staticClass:"iconfont icon-mubiao_normal fs-22 pr-10"}),s("span",{staticClass:"fs-22 gray-dark"},[e._v(e._s(e.target.objName))]),s("br"),s("span",{staticClass:"fs-14 gray"},[e._v("\n          目标类型："+e._s("DP"===e.target.objType?"部门":"")+e._s("PS"===e.target.objType?"个人":"")+e._s("CP"===e.target.objType?"公司":"")+"    \n          截止时间："+e._s(e.target.period&&e.target.period.periodEnd)+"    \n          更新时间："),s("span",{directives:[{name:"show",rawName:"v-show",value:e.target.progressUpdateTime,expression:"target.progressUpdateTime"}]},[e._v(e._s(e._f("DateTime")(e.target.progressUpdateTime)))])]),e.target.progressUpdateType&&"AC"===e.target.progressUpdateType.value&&e.target.objProgress?s("el-progress",{staticClass:"mt-5",attrs:{percentage:e.target.objProgress?Number(e.target.objProgress.progress.toFixed(2)):0,color:e.progressColor[e.target.objProgress.progressState.value]}}):e._e(),e.target.progressUpdateType&&"MU"===e.target.progressUpdateType.value?s("el-slider",{class:e.target.objProgress.progressState.value,attrs:{disabled:!(e.target.privileges&&e.target.privileges.updateProgress&&e.target.objState&&"CM"!==e.target.objState.value)},model:{value:e.target.objProgress&&e.target.objProgress.progress,callback:function(t){e.$set(e.target.objProgress&&e.target.objProgress,"progress",t)},expression:"target.objProgress && target.objProgress.progress"}}):e._e()],1),s("el-col",{staticStyle:{"border-right":"solid 1px #eee"},attrs:{span:4,offset:1}},[s("div",[s("i",{staticClass:"iconfont icon-fuzeren pr-10"}),s("span",{staticClass:"fs-14 gray"},[e._v("负责人")]),s("br")]),s("div",{staticClass:"flex",staticStyle:{"margin-top":"5px","margin-left":"20px"}},[s("avatar",{attrs:{user:e.target.objUser}}),s("div",{staticClass:"fs-14 gray",staticStyle:{padding:"5px 0 0 5px"}},[e._v(e._s(e.target.objUser&&e.target.objUser.userName))])],1)]),s("el-col",{staticClass:"txt-center",attrs:{span:3}},[s("i",{staticClass:"iconfont icon-pingfen pr-10"}),s("span",{staticClass:"fs-14 gray"},[e._v("评分")]),s("br"),s("span",{staticClass:"fs-32 primary"},[e._v(e._s(e.target.scores&&e.target.scores["个人评分"]||"--"))])])],1),s("el-row",{staticClass:"mt-15",staticStyle:{"line-height":"28px","padding-bottom":"5px","border-bottom":"solid 1px #ddd"}},[s("el-col",{attrs:{span:24}},[s("i",{staticClass:"iconfont icon-guanjianjiedian pr-10"}),e._v("关键结果")])],1),e._l(e.target.keyResults,(function(t,a){return s("el-row",{staticClass:"mt-15",staticStyle:{"line-height":"28px"}},[s("el-col",{staticClass:"flex circle-progress",attrs:{span:e.target.privileges&&e.target.privileges.updateProgress&&t.canView&&t.progressState?16:24}},[s("el-progress",{staticClass:"fl",class:t.progressState&&t.progressState.value,attrs:{type:"circle",percentage:t.progress||0,width:60,color:e.progressColor[t.progressState&&t.progressState.value||"NM"]}}),s("div",{staticStyle:{"margin-left":"15px",float:"left"}},[e._v("\n        "+e._s(t.keyResult||"********")+"  "),s("span",{directives:[{name:"show",rawName:"v-show",value:"AC"===e.target.progressUpdateType.value,expression:"target.progressUpdateType.value==='AC'"}]},[e._v("[权重"+e._s(t.weight)+"%]")]),s("br"),s("span",{staticClass:"pr-10"},[e._v("当前进度:")]),e.target.privileges&&e.target.privileges.updateProgress?s("span",[!0===t.canView&&"SD"===t.unitType.value?s("span",[s("el-input",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:t.curVal,callback:function(s){e.$set(t,"curVal",s)},expression:"item.curVal"}},[s("span",{attrs:{slot:"append"},slot:"append"},[e._v(e._s(t.unit))])]),e._v("\n              起始:"+e._s(t.startVal)+e._s(t.unit)+"  目标:"+e._s(t.endVal)+e._s(t.unit)+"\n          ")],1):e._e(),!0===t.canView&&"YN"===t.unitType.value?s("el-switch",{attrs:{"active-value":100,"inactive-value":0,"active-text":"完成","inactive-text":"未完成",disabled:e.target.objState&&"CM"===e.target.objState.value},model:{value:t.curVal,callback:function(s){e.$set(t,"curVal",s)},expression:"item.curVal"}}):e._e(),s("span",{directives:[{name:"show",rawName:"v-show",value:e.target.scores,expression:"target.scores"}]},[e._v(e._s(t.canView?t.curVal:"**")+"%")]),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.target.scores&&!1===t.canView,expression:"!target.scores && item.canView===false"}]},[e._v("**%")])],1):e._e(),e.target.privileges&&!e.target.privileges.updateProgress?s("span",[s("span",{directives:[{name:"show",rawName:"v-show",value:t.canView,expression:"item.canView"}]},[s("span",{directives:[{name:"show",rawName:"v-show",value:"SD"===t.unitType.value,expression:"item.unitType.value === 'SD'"}]},[e._v(e._s(t.curVal)+e._s(t.unit))]),s("span",{directives:[{name:"show",rawName:"v-show",value:"YN"===t.unitType.value,expression:"item.unitType.value === 'YN'"}]},[e._v(e._s(0===t.curVal?"未完成":"完成"))])]),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.canView,expression:"!item.canView"}]},[e._v("\n              ****\n          ")])]):e._e()])],1),e.target.privileges&&e.target.privileges.updateProgress&&t.canView&&t.progressState?s("el-col",{staticClass:"txt-right",attrs:{span:8}},[e._v("\n      状态\n      "),s("el-radio-group",{staticStyle:{"margin-left":"10px"},model:{value:t.progressState.value,callback:function(s){e.$set(t.progressState,"value",s)},expression:"item.progressState.value"}},e._l(e.enumType.ProgressState,(function(t){return s("el-radio",{class:t.value,attrs:{label:t.value,disabled:e.target.objState&&"CM"===e.target.objState.value}},[e._v(e._s(t.name)+"\n        ")])})),1),s("br"),s("el-button",{directives:[{name:"show",rawName:"v-show",value:e.target.objState&&"CM"!==e.target.objState.value,expression:"target.objState && target.objState.value!=='CM'"}],attrs:{type:"text"},on:{click:function(t){return e.showScoreRule(a)}}},[e._v("设置打分规则")])],1):e._e(),s("el-col",{attrs:{span:24}},[s("div",{staticStyle:{width:"95%",height:"1px",background:"#efefef","margin-left":"2.5%","margin-top":"15px"}})])],1)})),s("el-row",{directives:[{name:"show",rawName:"v-show",value:e.target.privileges&&e.target.privileges.updateProgress,expression:"target.privileges && target.privileges.updateProgress"}],staticClass:"mt-15"},[s("el-col",{attrs:{span:24}},[s("dialog-panel",{attrs:{comment:e.comment,tips:"更新进度说明"},on:{setComment:e.setComment}}),s("el-button",{staticClass:"mt-15",attrs:{type:"primary",size:"mini",round:""},on:{click:e.updateProgress}},[e._v("更新进度")])],1)],1),s("div",{staticClass:"form mt-15",staticStyle:{"border-bottom":"solid 1px #ddd","padding-bottom":"15px"}},[s("el-row",{staticClass:"user-wrap"},[s("el-col",{staticClass:"flex",staticStyle:{"line-height":"32px"},attrs:{span:24}},[s("div",{staticClass:"pr-10"},[s("i",{staticClass:"iconfont icon-fuzeren pr-10"}),e._v("参与人")]),e._l(e.target.objMembers,(function(t,a){return s("div",{staticClass:"avatar",on:{click:e.showObjMembersPanel}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.target.privileges&&e.target.privileges.editObj&&!e.target.scores,expression:"target.privileges && target.privileges.editObj  && !target.scores"}],staticClass:"close",on:{click:function(e){e.stopPropagation()}}},[s("i",{staticClass:"iconfont icon-guanbi",on:{click:function(t){return e.removeObjMembers(a)}}})]),s("avatar",{attrs:{user:t}})],1)})),s("div",{directives:[{name:"show",rawName:"v-show",value:e.target.privileges&&e.target.privileges.editObj&&!e.target.scores,expression:"target.privileges && target.privileges.editObj && !target.scores"}]},[s("i",{staticClass:"iconfont icon-tianjia pointer fs-22",on:{click:e.showObjMembersPanel}})]),s("member-panel",{attrs:{top:"-360px",left:"-275px",xKey:"team",visible:e.objMembersPanel,member:e.target.objMembers},on:{close:e.closeObjMembersPanel,setMember:e.setObjMembersMember}})],2)],1)],1),s("target-operation",{ref:"operation",staticClass:"mt-15",attrs:{id:e.target.objId,type:"obj",status:e.target.objState&&e.target.objState.value,user:e.target.objUser},on:{replyUser:e.replyUser}}),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("target-dialog",{ref:"dialog",attrs:{id:e.target.objId},on:{refreshOperation:e.refreshOperation}})],1),s("target-score",{attrs:{target:e.target,append:!0,index:e.score.index},on:{TARGET_SCORE:e.getDetail}}),s("target-edit",{attrs:{stage:e.target.period,detail:e.edit.detail,append:!0,type:"modify",id:e.target.objId},on:{TARGET_EDIT:e.getDetail}}),s("target-finish",{attrs:{stage:e.target.period,append:!0,id:e.finish.id,type:e.target.progressUpdateType&&e.target.progressUpdateType.value},on:{TARGET_FINISH:e.getDetail}}),s("target-communicate",{attrs:{params:e.communicate,append:!0},on:{SEND_COMMUNICATE:e.onCommunicate}})],2)},i=[],o=(s("e680"),s("0837")),n=s("45cc"),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"target-wrap table-wrap",attrs:{visible:e.dialogVisible,width:"850px","show-close":!1,"append-to-body":e.append,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-mubiao_normal primary"}),e._v(" 设置打分规则\n    ")]),s("div",{staticClass:"options"},[s("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.dialogVisible=!1}}})]),s("div",{staticClass:"clear"})]),s("el-row",{staticStyle:{"border-top":"solid 1px #ddd"}},[s("el-col",{staticClass:"gray-block",attrs:{span:4}},[e._v("目标名称")]),s("el-col",{attrs:{span:10}},[e._v(e._s(e.target.objName))]),s("el-col",{staticClass:"gray-block",attrs:{span:4}},[e._v("目标负责人")]),s("el-col",{staticStyle:{padding:"7px",display:"flex","align-items":"center"},attrs:{span:6}},[s("span",{staticClass:"round-title"},[s("avatar",{attrs:{user:e.target.objUser}})],1),s("span",{staticClass:"fs-14 gray pl-10"},[e._v(e._s(e.target.objUser&&e.target.objUser.userName))])])],1),s("el-row",[s("el-col",{staticClass:"gray-block",attrs:{span:4}},[e._v("关键结果")]),s("el-col",{attrs:{span:20}},[e._v(e._s(e.scoreRule.keyResult.keyResult))])],1),s("el-row",[s("el-col",{staticClass:"gray-block",attrs:{span:4}},[e._v("起始数值")]),s("el-col",{attrs:{span:8}},[e._v(e._s(e.scoreRule.keyResult.startVal)+e._s(e.scoreRule.keyResult.unit))]),s("el-col",{staticClass:"gray-block",attrs:{span:4}},[e._v("目标数值")]),s("el-col",{attrs:{span:8}},[e._v(e._s(e.scoreRule.keyResult.endVal)+e._s(e.scoreRule.keyResult.unit))])],1),s("el-form",{ref:"form",staticStyle:{"margin-top":"20px"},attrs:{model:e.scoreRule.form,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"30分标准"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:e.scoreRule.form.criterion30,callback:function(t){e.$set(e.scoreRule.form,"criterion30",t)},expression:"scoreRule.form.criterion30"}})],1),s("el-form-item",{attrs:{label:"70分标准"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:e.scoreRule.form.criterion70,callback:function(t){e.$set(e.scoreRule.form,"criterion70",t)},expression:"scoreRule.form.criterion70"}})],1),s("el-form-item",{attrs:{label:"100分标准"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入内容"},model:{value:e.scoreRule.form.criterion100,callback:function(t){e.$set(e.scoreRule.form,"criterion100",t)},expression:"scoreRule.form.criterion100"}})],1),s("el-form-item",[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.saveScoreRule}},[e._v("保存")]),s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),s("el-button",{attrs:{type:"text"},on:{click:e.clearScoreRule}},[e._v("清空")])],1)],1)],1)},l=[],c=s("4ca0"),u=s("7150"),p={name:"targetClose",props:{target:Object,visible:{type:Boolean,default:function(){return!1}},append:{type:Boolean,default:function(){return!1}},index:Number},components:{avatar:u["a"]},data:function(){return{dialogVisible:!1,scoreRule:{form:{},keyResult:{}}}},watch:{index:function(e){void 0!==e&&(this.getScoreRule(e),this.dialogVisible=!0)}},created:function(){},methods:{getScoreRule:function(e){var t=this;c["a"].scoreRule(this.target.keyResults[e].keyResultId).then((function(s){200===s.code&&(t.scoreRule={form:s.data,keyResult:t.target.keyResults[e]})})).catch((function(e){console.log(e)})),this.scoreRule.dialogVisible=!0},saveScoreRule:function(){var e=this;c["a"].setScoreRule(this.scoreRule.form,this.scoreRule.keyResult.keyResultId).then((function(t){200===t.code&&(e.$message.success({message:"打分规则设置成功!",duration:1500}),e.scoreRule={form:{},keyResult:{}},e.$emit("modifyScore"))})).catch((function(e){console.log(e)}))},clearScoreRule:function(){for(var e in this.scoreRule.form)this.scoreRule.form[e]=""},closePanel:function(){this.$emit("closeScorePanel")}}},m=p,d=(s("802d"),s("4ac2")),g=Object(d["a"])(m,r,l,!1,null,"7d5a1000",null),f=g.exports,h=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"target-wrap",attrs:{visible:e.dialogVisible,width:"850px","show-close":!1,"append-to-body":e.append,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-jieshu primary"}),e._v(" 结束目标\n    ")]),s("div",{staticClass:"options"},[s("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.dialogVisible=!1}}})]),s("div",{staticClass:"clear"})]),s("div",{staticClass:"dialog-wrap"},[e._l(e.list,(function(t){return s("el-row",{staticClass:"mt-15",staticStyle:{"border-bottom":"solid 1px #ddd","padding-bottom":"20px"}},[s("el-col",{attrs:{span:3}},[s("el-progress",{staticStyle:{float:"left"},attrs:{type:"circle",percentage:t.progress||0,width:60,color:e.progressColor[t.progressState.value]}})],1),s("el-col",{attrs:{span:21}},[s("el-row",[s("el-col",{attrs:{span:24}},[e._v("\n            "+e._s(t.keyResult||"********")+"  "),s("span",{directives:[{name:"show",rawName:"v-show",value:"AC"===t.progressUpdateType.value,expression:"item.progressUpdateType.value==='AC'"}]},[e._v("[权重"+e._s(t.weight)+"%]")]),s("br"),s("span",{staticClass:"pr-10"},[e._v("当前进度:"+e._s(t.progress)+"%    起始:"+e._s(t.startVal)+"    结束:"+e._s(t.endVal))])])],1),s("el-row",{staticStyle:{"margin-top":"10px"}},[s("el-col",{staticStyle:{"padding-top":"9px"},attrs:{span:3}},[e._v("结果打分")]),s("el-col",{attrs:{span:21}},[s("el-slider",{class:t.progressState.value,staticStyle:{width:"97%"},attrs:{step:10,marks:e.marks},on:{input:e.sumScoreResult},model:{value:t.score,callback:function(s){e.$set(t,"score",s)},expression:"item.score"}})],1)],1),s("el-row",{staticStyle:{"margin-top":"15px"}},[s("el-col",{staticClass:"mt-20",attrs:{span:3}},[e._v("结果总结")]),s("el-col",{staticClass:"mt-20",attrs:{span:21}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:t.summary,callback:function(s){e.$set(t,"summary",s)},expression:"item.summary"}})],1)],1)],1)],1)})),s("el-row",{staticStyle:{"margin-top":"20px"}},[s("el-col",{attrs:{span:3}},[e._v("项目总结")]),s("el-col",{attrs:{span:21}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入内容"},model:{value:e.summary,callback:function(t){e.summary=t},expression:"summary"}})],1)],1),s("el-row",{staticStyle:{"margin-top":"15px"}},[s("el-col",{attrs:{span:20}},[s("el-button",{staticClass:"mr-10",attrs:{type:"primary",size:"mini"},on:{click:e.setScore}},[e._v("确定")]),s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")])],1),s("el-col",{staticClass:"txt-right",attrs:{span:4}},[s("i",{staticClass:"iconfont icon-target"}),e._v("得分:"+e._s(e.result.toFixed(2))+"\n      ")])],1)],2)])},v=[],b={name:"targetClose",props:{stage:Object,type:String,visible:{type:Boolean,default:function(){return!1}},append:{type:Boolean,default:function(){return!1}},id:String},components:{},computed:{progressColor:function(){return this.$store.getters.progressColor}},data:function(){return{dialogVisible:!1,list:[],result:0,summary:"",marks:{0:"0",10:"10",20:"20",30:"30",40:"40",50:"50",60:"60",70:"70",80:"80",90:"90",100:{style:{width:"30px"},label:"100"}}}},watch:{id:function(e){e&&(this.id=e,this.getScoreInfo(),this.dialogVisible=!0)}},created:function(){},methods:{getScoreInfo:function(){var e=this;c["a"].scoreInfo(this.id).then((function(t){200===t.code&&(e.list=t.data)})).catch((function(e){console.log(e)}))},sumScoreResult:function(){var e=0;if("MU"===this.type){for(var t in this.list)e+=Number(this.list[t].score||0);e/=this.list.length}else for(var s in this.list)e+=Number(this.list[s].score*this.list[s].weight/100);this.result=e},setScore:function(){var e=this,t={objScore:this.result,scoreType:"PS",summary:this.summary};for(var s in this.list)t["scores["+s+"].keResultScore"]=Number(this.list[s].score),t["scores["+s+"].keyResultId"]=this.list[s].keyResultId,t["scores["+s+"].keyResultSummary"]=this.list[s].summary;console.log(t);var a=this,i=this.$createElement;this.$msgbox({title:"评分内容",message:i("div",null,function(){var e=[];for(var t in a.list)e.push(i("div",null,[i("span",null,"关键结果【"+a.list[t].keyResult+"】评分："),i("span",{style:"color: orange; fontWeight:bold"},a.list[t].score+"分"),i("span",null,"  总结："),i("span",{style:"color: orange; fontWeight:bold"},a.list[t].summary)]));return e.push(i("div",null,[i("span",null,"项目评分："),i("span",{style:"color: orange; fontWeight:bold"},a.result+"分")])),e.push(i("div",null,[i("span",null,"项目总结："),i("span",{style:"color: orange; fontWeight:bold"},a.summary||"")])),e}()),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonClass:"confirm-btn-scope"}).then((function(s){c["a"].setScore(t,e.id).then((function(t){200===t.code&&(e.$message.success({message:"项目评分成功!",duration:1500}),e.dialogVisible=!1,e.$emit("TARGET_FINISH"))})).catch((function(e){console.log(e)}))})).catch((function(){}))},closePanel:function(){this.$emit("closeTargetFinishPanel")}}},y=b,w=Object(d["a"])(y,h,v,!1,null,"bc65e134",null),C=w.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{span:24}},[a("span",{staticClass:"tab-btn",class:{primary:"comment"===e.view},on:{click:function(t){return e.setInfo("comment")}}},[a("i",{staticClass:"iconfont icon-pinglun mr-5"}),e._v(e._s("CM"!==e.status?"评论":"沟通记录"))]),a("span",{directives:[{name:"show",rawName:"v-show",value:"CM"!==e.status,expression:"status!=='CM'"}],staticClass:"tab-btn",class:{primary:"history"===e.view},on:{click:function(t){return e.setInfo("history")}}},[a("i",{staticClass:"iconfont icon-jindulishi mr-5"}),e._v("进度历史")]),a("span",{directives:[{name:"show",rawName:"v-show",value:"CM"!==e.status,expression:"status!=='CM'"}],staticClass:"tab-btn",class:{primary:"activity"===e.view},on:{click:function(t){return e.setInfo("activity")}}},[a("i",{staticClass:"iconfont icon-huodong mr-5"}),e._v("活动")]),a("like",{directives:[{name:"show",rawName:"v-show",value:"CM"!==e.status,expression:"status!=='CM'"}],staticClass:"fr",attrs:{id:e.id,type:"obj"}}),a("span",{directives:[{name:"show",rawName:"v-show",value:e.followListVisible,expression:"followListVisible"}],staticClass:"fr pointer mr-10",on:{click:e.showFollowList}},[a("span",{staticClass:"fs-14 pointer"},[a("i",{staticClass:"iconfont icon-guanzhu mr-10 warning"}),e._v("已关注")])]),a("follow",{directives:[{name:"show",rawName:"v-show",value:"CM"!==e.status&&!e.followListVisible,expression:"status!=='CM' && !followListVisible"}],staticClass:"fr mr-10",attrs:{id:e.id}})],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"comment"===e.view,expression:"view==='comment'"}],staticClass:"mt-15"},[a("el-col",{attrs:{span:22,offset:1}},[e._l(e.comment.list,(function(t){return a("el-row",{staticStyle:{"margin-top":"10px","padding-bottom":"10px","border-bottom":"solid 1px #ddd"}},[a("el-col",{attrs:{span:1}},[a("avatar",{attrs:{user:t.commentUser}})],1),a("el-col",{staticClass:"comment-list",staticStyle:{"padding-left":"10px"},attrs:{span:23}},[a("div",[e._v(e._s(t.commentUser.userName)+"    "+e._s(e._f("TimeSecond")(t.commentTime))+"\n            "),t.selfComment?e._e():a("i",{staticClass:"iconfont icon-huifu fr pointer",on:{click:function(s){return e.replyUser(t)}}}),t.selfComment?a("i",{staticClass:"iconfont icon-delete fr pointer",on:{click:function(s){return e.deleteComment(t.commentId)}}}):e._e()]),a("div",{domProps:{innerHTML:e._s(t.content)}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.replys&&t.replys.length>0,expression:"item.replys && item.replys.length>0"}],staticStyle:{padding:"10px 20px","border-radius":"5px",background:"#f5f5f5","margin-top":"10px"}},e._l(t.replys,(function(s,i){return a("el-row",{key:i,staticStyle:{"margin-top":"10px"}},[a("el-col",{attrs:{span:2}},[a("avatar",{attrs:{user:s.commentUser}})],1),a("el-col",{attrs:{span:22}},[a("div",[e._v(e._s(s.commentUser.userName)+"    "+e._s(e._f("TimeSecond")(s.replyTime))+"\n                  "),s.selfComment?e._e():a("i",{staticClass:"iconfont icon-huifu fr pointer",on:{click:function(s){return e.replyUser(t)}}}),s.selfComment?a("i",{staticClass:"iconfont icon-delete fr pointer",on:{click:function(t){return e.deleteComment(s.commentId)}}}):e._e()]),a("div",{domProps:{innerHTML:e._s(s.content)}})])],1)})),1)])],1)})),a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.comment.list&&0===e.comment.list.length,expression:"comment.list && comment.list.length===0"}]},[a("el-col",[a("div",{staticClass:"w-100p gray",staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:s("3729")}}),a("br"),a("span",{staticStyle:{"font-size":"14px"}},[e._v("暂无数据")]),a("br"),a("br")])])],1)],2)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"history"===e.view,expression:"view==='history'"}],staticClass:"mt-15"},[a("el-col",{attrs:{span:22,offset:1}},[a("el-timeline",e._l(e.history.list,(function(t,s){return a("el-timeline-item",{key:s,attrs:{placement:"top",timestamp:t.updateTime}},[a("div",{directives:[{name:"show",rawName:"v-show",value:"C"===t.progressType.value,expression:"item.progressType.value==='C'"}]},[e._v("\n            "+e._s(t.progressType.name)+"\n          ")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"C"!==t.progressType.value,expression:"item.progressType.value!=='C'"}]},[e._v("\n            目标进度："+e._s(t.progress.objProgress)+"%\n            "),a("span",{directives:[{name:"show",rawName:"v-show",value:0!==t.progress.objProgressDiff,expression:"item.progress.objProgressDiff!==0"}],class:{danger:t.progress.objProgressDiff<0,success:t.progress.objProgressDiff>0}},[a("i",{staticClass:"iconfont fs-12",class:{"icon-xiajiang danger":t.progress.objProgressDiff<0,"icon-shangsheng success":t.progress.objProgressDiff>0}}),e._v("\n                "+e._s(t.progress.objProgressDiff)+"%\n              ")]),a("br"),e._v("\n            更新说明："),a("span",{domProps:{innerHTML:e._s(t.comment&&t.comment.content)}}),a("br"),a("span",{directives:[{name:"show",rawName:"v-show",value:t.progress.keyResultProgresses.length>0,expression:"item.progress.keyResultProgresses.length>0"}]},[e._v("\n                关键结果：\n                "),e._l(t.progress.keyResultProgresses,(function(t){return a("span",[e._v("\n                  "+e._s(t.keyResult)+":"+e._s(t.progress)+"%\n                  "),a("span",{directives:[{name:"show",rawName:"v-show",value:0!==t.progressDiff,expression:"keyResult.progressDiff!==0"}],class:{danger:t.progressDiff<0,success:t.progressDiff>0}},[a("i",{staticClass:"iconfont fs-12",class:{"icon-xiajiang danger":t.progressDiff<0,"icon-shangsheng success":t.progressDiff>0}}),e._v("\n                  "+e._s(t.progressDiff)+"%      \n                  ")])])}))],2),a("br")])])})),1)],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:e.history.list&&0===e.history.list.length,expression:"history.list && history.list.length === 0"}],attrs:{span:22,offset:1}},[a("div",{staticClass:"w-100p gray",staticStyle:{"text-align":"center"}},[a("div",{staticStyle:{margin:"0 auto"}},[a("i",{staticClass:"iconfont icon-zanwupinglun",staticStyle:{"font-size":"96px"}})]),a("div",{staticStyle:{margin:"0 auto","font-size":"14px"}},[e._v("暂无数据")])])])],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"activity"===e.view,expression:"view==='activity'"}],staticClass:"mt-15"},[a("el-col",{attrs:{span:22,offset:1}},[e._l(e.activity.list,(function(t){return a("el-row",{staticStyle:{"padding-bottom":"10px","margin-top":"10px"}},[a("el-col",{staticStyle:{"text-align":"center",position:"relative"},attrs:{span:24}},[a("span",{staticStyle:{padding:"0 10px",background:"#fff"}},[e._v(e._s(e._f("DateTime")(t.activityTime)))]),a("div",{staticStyle:{position:"absolute",height:"1px",width:"42%",background:"#ddd",top:"10px",left:"0"}}),a("div",{staticStyle:{position:"absolute",height:"1px",width:"42%",background:"#ddd",top:"10px",right:"0"}})]),a("el-col",{staticStyle:{display:"flex"},attrs:{span:4}},[a("avatar",{attrs:{user:t.activityUser}}),a("div",{staticStyle:{"padding-top":"5px"}},[e._v(e._s(t.activityUser.userName))])],1),a("el-col",{attrs:{span:20}},e._l(t.content,(function(t){return a("div",{staticStyle:{"line-height":"32px"},domProps:{innerHTML:e._s(t)}})})),0)],1)})),a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.activity.list&&0===e.activity.list.length,expression:"activity.list && activity.list.length===0"}]},[a("el-col",[a("div",{staticClass:"w-100p gray",staticStyle:{"text-align":"center"}},[a("div",{staticStyle:{margin:"0 auto"}},[a("i",{staticClass:"iconfont icon-zanwupinglun",staticStyle:{"font-size":"96px"}})]),a("div",{staticStyle:{margin:"0 auto","font-size":"14px"}},[e._v("暂无数据")])])])],1)],2)],1),a("target-member",{attrs:{params:e.paramsMember,append:!0}})],1)},_=[],x=(s("8dee"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("span",{staticClass:"fs-14 pointer",on:{click:e.setLike}},[s("i",{staticClass:"iconfont icon-dianzan mr-10",class:{danger:e.liked}}),e._v(e._s(e.liked?"已赞":"点赞")+"    "+e._s(e.list))])])}),j=[],R={name:"Like",components:{},props:{id:String,type:String},data:function(){return{baseAPI:"https://dev-api.cgvcap.com",pageNum:1,pageSize:10,list:"",liked:!1}},watch:{id:function(e){e&&(this.getList(),this.hasLiked())}},mounted:function(){var e=this;setTimeout((function(){e.getList(),e.hasLiked()}),500)},methods:{getList:function(){var e=this;this.list="";var t={bizType:this.type,pageNum:this.pageNum,pageSize:this.pageSize};c["a"].likeList(t,this.id).then((function(t){if(200===t.code){for(var s in t.data.list)if(e.list+=t.data.list[s].likeUser.userName+",",parseInt(s)>2)return void(e.list="["+e.list.substring(0,e.list.length-1)+"等共"+t.data.total+"人点赞]");e.list.length>0&&(e.list="["+e.list.substring(0,e.list.length-1)+"共"+t.data.total+"人点赞]")}})).catch((function(e){console.log(e)}))},hasLiked:function(){var e=this,t={bizType:this.type};c["a"].hasLiked(t,this.id).then((function(t){200===t.code&&(e.liked=t.data)})).catch((function(e){console.log(e)}))},setLike:function(){var e=this,t={bizType:this.type};this.liked?c["a"].removeLike(t,this.id).then((function(t){200===t.code&&(e.getList(),e.liked=!1,e.$message.success({message:"取消点赞成功",duration:1500}))})).catch((function(e){console.log(e)})):c["a"].addLike(t,this.id).then((function(t){200===t.code&&(e.getList(),e.liked=!0,e.$message.success({message:"点赞成功",duration:1500}))})).catch((function(e){console.log(e)}))}}},T=R,S=Object(d["a"])(T,x,j,!1,null,"015c66bc",null),V=S.exports,N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("span",{staticClass:"fs-14 pointer",on:{click:e.setFollow}},[s("i",{staticClass:"iconfont icon-guanzhu mr-10",class:{warning:e.followed}}),e._v(e._s(e.followed?"已关注":"关注"))])])},P=[],$={name:"Follow",components:{},props:{id:String},data:function(){return{list:"",followed:!1}},watch:{id:function(e){e&&(this.getList(),this.hasFollow())}},mounted:function(){var e=this;setTimeout((function(){e.getList(),e.hasFollow()}),500)},methods:{getList:function(){this.list="",c["a"].followList(this.id).then((function(e){e.code})).catch((function(e){console.log(e)}))},hasFollow:function(){var e=this;c["a"].hasFollow(this.id).then((function(t){200===t.code&&(e.followed=t.data)})).catch((function(e){console.log(e)}))},setFollow:function(){var e=this;this.followed?c["a"].unFollow(this.id).then((function(t){200===t.code&&(e.getList(),e.followed=!1,e.$message.success({message:"取消关注成功",duration:1500}))})).catch((function(e){console.log(e)})):c["a"].follow(this.id).then((function(t){200===t.code&&(e.getList(),e.followed=!0,e.$message.success({message:"关注成功",duration:1500}))})).catch((function(e){console.log(e)}))}}},M=$,I=Object(d["a"])(M,N,P,!1,null,"0c70d319",null),U=I.exports,D=s("483c"),O={name:"targetOperation",props:{id:String,type:String,status:String,user:Object},components:{follow:U,like:V,avatar:u["a"],targetMember:D["a"]},data:function(){return{view:"",comment:{pageNum:1,pageSize:10,list:"",total:0},history:{pageNum:1,pageSize:10,list:"",total:0},activity:{pageNum:1,pageSize:10,list:"",total:0},curUsers:this.$store.state.user,followListVisible:!1,paramsMember:{}}},watch:{id:function(e){e&&this.refresh()}},mounted:function(){var e=this;setTimeout((function(){e.setInfo("comment")}),100),this.followListVisible=this.curUsers.user.jwtClaims.id===this.user.userId},methods:{setInfo:function(e){switch(this.view=e,e){case"comment":this.getCommentList();break;case"history":this.getHistory();break;case"activity":this.getActivity();break}},getCommentList:function(){var e=this,t={bizType:this.type,pageNum:this.comment.pageNum,pageSize:this.comment.pageSize};c["a"].commentList(t,this.id).then((function(t){if(200===t.code){for(var s in t.data.list)t.data.list[s].content=t.data.list[s].content.replace(/\n/g,"<br/>");e.comment.list=t.data.list,e.comment.total=t.data.total}})).catch((function(e){console.log(e)}))},getHistory:function(){var e=this;c["a"].history(this.id).then((function(t){200===t.code&&(e.history.list=t.data.reverse())})).catch((function(e){console.log(e)}))},getActivity:function(){var e=this,t={bizType:this.type,pageNum:this.activity.pageNum,pageSize:this.activity.pageSize};c["a"].activity(t,this.id).then((function(t){200===t.code&&(e.activity.list=t.data.list)})).catch((function(e){console.log(e)}))},refresh:function(){console.log("refresh dialog"),this.comment={pageNum:1,pageSize:10,list:"",total:0},this.history={pageNum:1,pageSize:10,list:"",total:0},this.activity={pageNum:1,pageSize:10,list:"",total:0},this.setInfo(this.view)},deleteComment:function(e){var t=this;this.$confirm("即将删除评论，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){c["a"].deleteComment(e).then((function(e){200===e.code&&(t.getCommentList(),t.$message.success({message:"评论删除成功!",duration:1500}))})).catch((function(e){console.log(e)}))})).catch((function(e){}))},replyUser:function(e){this.$emit("replyUser",e)},showFollowList:function(){this.paramsMember={params:{id:this.id,type:"follow"},title:"关注人列表"}}}},z=O,L=(s("cf89"),Object(d["a"])(z,k,_,!1,null,"75085058",null)),E=L.exports,A=s("956b"),B=s("c4ce"),W=s("40c4"),F={name:"TargetDetail",props:{visible:{type:Boolean,default:function(){return!1}},append:{type:Boolean,default:function(){return!1}},obj:Object},components:{dialogPanel:o["a"],memberPanel:W["a"],avatar:u["a"],targetEdit:n["a"],targetFinish:C,targetOperation:E,targetScore:f,targetDialog:A["a"],targetCommunicate:B["a"]},computed:{progressColor:function(){return this.$store.getters.progressColor},user:function(){return this.$store.getters.user}},data:function(){return{dialogVisible:!1,msg:"",enumType:{},scoreRule:{dialogVisible:!1,form:{},keyResult:{}},comment:{},target:{},objMembersPanel:!1,edit:{visible:!1,detail:{}},finish:{visible:!1,id:""},operation:{visible:!1,id:""},score:{visible:!1,id:""},communicate:{users:[],panelVisible:!1,comment:{},msg:"",dialogVisible:!1,params:{}}}},watch:{obj:function(e){for(var t in this.target=e,e.keyResults)this.$set(this.target.keyResults[t],"progressTxt",e.keyResults[t].progress);this.target.objMembers=this.target.objMembers||[],this.dialogVisible=!0}},created:function(){this.getEnum("ProgressState")},mounted:function(){this.userInfo={userAvatar:this.user.user.jwtClaims.ua,userId:this.user.user.jwtClaims.id,userName:this.user.user.jwtClaims.un,size:35}},methods:{getEnum:function(e){var t=this;c["a"].getEnum(e).then((function(s){200===s.code&&t.$set(t.enumType,e,s.data)})).catch((function(e){console.log(e)}))},closeDialog:function(){this.dialogVisible=!1,this.$emit("closeTargetDetail")},targetDetail:function(){this.dialogVisible=!1,this.$emit("TARGET_DETAIL")},showScoreRule:function(e){console.log(e),this.score={index:e}},updateProgress:function(){var e=this,t={"comment.content":this.comment.content||""};if(this.comment.attachments&&this.comment.attachments.length>0)for(var s in this.comment.attachments)t["comment.attachments["+s+"]"]="https://dev-oss.cgvcap.com/file/"+this.comment.attachments[s].fileId+"/"+this.comment.attachments[s].accessCode;"MU"===this.target.progressUpdateType.value&&(t.progress=this.target.objProgress.progress);var a=0;for(var i in this.target.keyResults)this.target.keyResults[i].canView&&(t["keyResults["+a+"].keyResultId"]=this.target.keyResults[i].keyResultId,t["keyResults["+a+"].progress"]=this.target.keyResults[i].progress,t["keyResults["+a+"].curVal"]=Number(this.target.keyResults[i].curVal),t["keyResults["+a+"].progressState"]=this.target.keyResults[i].progressState?this.target.keyResults[i].progressState.value:"",a++);if(console.log(t),"MU"===this.target.progressUpdateType.value){var o=this,n=this.$createElement;this.$msgbox({title:"更新提示",message:n("div",null,function(){var s=[];for(var a in"MU"===e.target.progressUpdateType.value&&s.push(n("div",null,[n("span",null,"目标进度："),n("span",{style:"color: orange; fontWeight:bold"},(t.progress||0)+"%")])),o.target.keyResults)o.target.keyResults[a].canView&&("SD"===o.target.keyResults[a].unitType.value?s.push(n("div",null,[n("span",null,"关键结果【"+o.target.keyResults[a].keyResult+"】进度："),n("span",{style:"color: orange; fontWeight:bold"},o.target.keyResults[a].curVal+o.target.keyResults[a].unit)])):s.push(n("div",null,[n("span",null,"关键结果【"+o.target.keyResults[a].keyResult+"】进度："),n("span",{style:"color: orange; fontWeight:bold"},0===o.target.keyResults[a].curVal?"未完成":"完成")])));var i=o.removeSpan(o.comment.content||"");return s.push(n("div",null,[n("span",null,"更新说明："),n("span",{style:"color: orange; fontWeight:bold"},i)])),s}()),showCancelButton:!0,confirmButtonText:"确定",cancelButtonText:"取消",confirmButtonClass:"confirm-btn-scope"}).then((function(s){c["a"].updateProgress(t,e.target.objId).then((function(t){200===t.code&&(e.comment={hidden:!0},e.getDetail(),e.refreshOperation(),e.$message.success({message:"进度更新成功!",duration:1500}))})).catch((function(e){console.log(e)}))})).catch((function(){}))}else c["a"].updateProgress(t,this.target.objId).then((function(t){200===t.code&&(e.comment={hidden:!0},e.getDetail(),e.refreshOperation(),e.$message.success({message:"进度更新成功!",duration:1500}))})).catch((function(e){console.log(e)}))},removeSpan:function(e){console.log("#####################");var t="",s=e.indexOf('<span class="success">'),a=e.indexOf("</span>",s),i=e.indexOf('<span class="warning">'),o=e.indexOf("</span>",i),n=e.indexOf('<span style="display: none">'),r=e.indexOf("</span>",n);return console.log(s,i,n),s>-1?(t=e.substring(0,s)+e.substring(s+22,a)+e.substring(a+7,e.length),console.log(t),this.removeSpan(t)):i>-1?(console.log(t),t=e.substring(0,i)+e.substring(i+22,o)+e.substring(o+7,e.length),this.removeSpan(t)):n>-1?(t=e.substring(0,n)+e.substring(r+7,e.length),console.log(t),this.removeSpan(t)):e},setComment:function(e){this.comment=e},setProgress:function(e){this.$set(this.target.keyResults[e],"progress",Number(this.target.keyResults[e].progressTxt))},setObjMembersMember:function(){var e=[];for(var t in this.target.objMembers)this.target.objMembers[t].id&&e.push(this.target.objMembers[t].id||this.target.objMembers[t].userId);c["a"].updateMembers({userIds:e},this.target.objId).then((function(e){e.code})).catch((function(e){console.log(e)}))},closeObjMembersPanel:function(){var e=this;setTimeout((function(){e.objMembersPanel=!1}))},editTarget:function(){var e=this;this.edit={visible:!0,detail:{progressUpdateType:this.target.progressUpdateType.value,deptId:this.target.objDept?this.target.objDept.deptId:"",objType:this.target.objType,objName:this.target.objName,users:"-1"!==this.target.objUser.userId?[this.target.objUser]:[],keyResults:function(){for(var t in e.target.keyResults)e.target.keyResults[t].unitType=e.target.keyResults[t].unitType.value||e.target.keyResults[t].unitType;return e.target.keyResults}(),parent:{objName:this.target.objParent?this.target.objParent.objName:"",objId:this.target.objParent?this.target.objParent.objId:""},totalWeight:0}}},getScoreInfo:function(){var e=this;this.finish.id="",setTimeout((function(){e.finish.id=e.target.objId}),50)},deleteTarget:function(){var e=this;this.$confirm("即将删除目标,并且不能恢复，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){c["a"].objDelete(e.target.objId).then((function(t){200===t.code&&(e.$message.success({message:"目标删除成功",duration:1500}),e.targetDetail())})).catch((function(e){console.log(e)}))})).catch((function(e){}))},showObjMembersPanel:function(){!this.target.scores&&this.target.privileges&&this.target.privileges.editObj&&(this.objMembersPanel=!0)},removeObjMembers:function(e){this.target.objMembers.splice(e,1)},refreshOperation:function(){this.$refs.operation.refresh()},getDetail:function(){var e=this;c["a"].objDetail(this.target.objId).then((function(t){if(200===t.code){for(var s in e.target=t.data,t.data.keyResults)e.$set(e.target.keyResults[s],"progressTxt",t.data.keyResults[s].progress);e.target.objMembers=e.target.objMembers||[],e.$emit("TARGET_DETAIL")}})).catch((function(e){console.log(e)}))},replyUser:function(e){this.$refs.dialog.replyUser(e)},onCommunicate:function(){}}},K=F,Y=(s("e2e1"),Object(d["a"])(K,a,i,!1,null,null,null));t["a"]=Y.exports},"45cc":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"target-wrap",attrs:{visible:e.dialogVisible,width:"850px","show-close":!1,"append-to-body":e.append,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"title"},[a("i",{staticClass:"iconfont icon-mubiao_normal"}),e._v(" "+e._s("new"===e.type?"新建目标":"编辑目标")+"\n    ")]),a("div",{staticClass:"options"},[a("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){return e.closePanel()}}})]),a("div",{staticClass:"clear"})]),a("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{staticClass:"w-50p fl",attrs:{label:"目标类型",prop:"objType",rules:{required:!0,message:"目标类型"}}},[a("el-select",{staticClass:"w-100p",attrs:{placeholder:"目标类型"},model:{value:e.form.objType,callback:function(t){e.$set(e.form,"objType",t)},expression:"form.objType"}},e._l(e.enumType.ObjectiveType,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}},[a("span",[e._v(e._s(t.name))])])})),1)],1),a("el-form-item",{staticClass:"w-50p fl",attrs:{label:"目标周期"}},[a("el-input",{attrs:{disabled:""},model:{value:e.stage.periodName,callback:function(t){e.$set(e.stage,"periodName",t)},expression:"stage.periodName"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"DP"===e.form.objType,expression:"form.objType === 'DP'"}],staticClass:"w-100p fl",attrs:{label:"部门"}},[a("el-select",{staticClass:"w-100p",attrs:{placeholder:"目标类型"},model:{value:e.form.deptId,callback:function(t){e.$set(e.form,"deptId",t)},expression:"form.deptId"}},e._l(e.deptList,(function(t){return a("el-option",{key:t.deptId,attrs:{label:t.deptName,value:t.deptId}},[a("span",{style:{paddingLeft:10*t.level+"px"}},[e._v(e._s(t.deptName))])])})),1)],1),a("el-form-item",{staticClass:"w-100p fl",attrs:{label:"目标名称",prop:"objName",rules:{required:!0,message:"目标名称",trigger:"blur"}}},[a("el-input",{model:{value:e.form.objName,callback:function(t){e.$set(e.form,"objName",t)},expression:"form.objName"}})],1),a("el-form-item",{staticClass:"w-100p fl",attrs:{label:"目标进度",prop:"objType"}},[a("el-radio-group",{model:{value:e.form.progressUpdateType,callback:function(t){e.$set(e.form,"progressUpdateType",t)},expression:"form.progressUpdateType"}},[a("el-radio",{attrs:{label:"AC"}},[e._v("关联更新\n          "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"根据关键结果进度及权重自动计算更新",placement:"top"}},[a("i",{staticClass:"iconfont icon-shuoming"})])],1),a("el-radio",{attrs:{label:"MU"}},[e._v("手动更新")])],1)],1),a("div",{staticClass:"row",staticStyle:{height:"38px"}},[a("div",{staticClass:"label"},[e._v("负责人 ")]),a("div",{staticClass:"flex"},[e._l(e.form.users,(function(t){return a("div",{staticClass:"avatar",on:{click:function(t){e.panelVisible=!0}}},[t?a("avatar",{attrs:{user:t}}):e._e()],1)})),a("div",{directives:[{name:"show",rawName:"v-show",value:e.form.users&&0===e.form.users.length,expression:"form.users && form.users.length===0"}]},[a("i",{staticClass:"iconfont icon-tianjia pointer fs-32",on:{click:function(t){e.panelVisible=!0}}})])],2),a("member-panel",{attrs:{top:"56px",left:"-260px",xKey:"team",visible:e.panelVisible,member:e.form.users},on:{close:e.closeMembersPanel,setMember:e.setUsers}})],1),a("div",{staticClass:"row"},[a("div",{staticClass:"label"},[e._v("关键结果")]),a("div",{staticClass:"key-wrap"},[e._l(e.form.keyResults,(function(t,s){return a("div",{staticClass:"w-100p"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:"AC"===e.form.progressUpdateType?18:23}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"输入关键结果",disabled:!t.canView},model:{value:t.keyResult,callback:function(s){e.$set(t,"keyResult",s)},expression:"item.keyResult"}})],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:"AC"===e.form.progressUpdateType,expression:"form.progressUpdateType==='AC'"}],staticClass:"weight-wrap",attrs:{span:5}},[e._v("\n              权重:\n              "),a("el-input",{attrs:{placeholder:"0",type:"number",size:"mini",disabled:!t.canView},on:{input:e.sumWeight},model:{value:t.weight,callback:function(s){e.$set(t,"weight",s)},expression:"item.weight"}}),e._v("\n              %\n            ")],1),a("el-col",{staticClass:"weight-wrap",attrs:{span:1}},[a("i",{staticClass:"iconfont icon-delete pointer",on:{click:function(t){return e.removeKeyResult(s)}}})])],1),a("el-row",{staticClass:"unit-wrap",attrs:{gutter:20}},[a("el-col",{attrs:{span:7}},[a("el-switch",{attrs:{"active-value":"SD","inactive-value":"YN","active-text":"自定单位","inactive-text":"是/否",disabled:!t.canView},model:{value:t.unitType,callback:function(s){e.$set(t,"unitType",s)},expression:"item.unitType"}}),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"是/否:仅有完成、未完成2种状态，即进度0%跟100%;  自定义单位:可自定义单位，进度可以手动输入。",placement:"top"}},[a("i",{staticClass:"iconfont icon-shuoming ml-10"})])],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:"YN"===t.unitType,expression:"item.unitType==='YN'"}],attrs:{span:17}},[e._v("\n              起始"),a("el-input",{staticClass:"start-input",attrs:{placeholder:"未完成",disabled:"",size:"mini"}}),e._v("\n              结束"),a("el-input",{staticClass:"end-input",attrs:{placeholder:"完成",disabled:"",size:"mini"}})],1),a("el-col",{directives:[{name:"show",rawName:"v-show",value:"SD"===t.unitType,expression:"item.unitType==='SD'"}],attrs:{span:17}},[e._v("\n              单位"),a("el-input",{staticClass:"unit-input",attrs:{placeholder:"%",size:"mini"},model:{value:t.unit,callback:function(s){e.$set(t,"unit",s)},expression:"item.unit"}}),e._v("\n              起始"),a("el-input",{staticClass:"unit-start-input",attrs:{placeholder:"0",size:"mini"},model:{value:t.startVal,callback:function(s){e.$set(t,"startVal",s)},expression:"item.startVal"}}),e._v(e._s(t.unit||"%")+"\n              "),a("span",{staticClass:"ml-10"},[e._v("目标")]),a("el-input",{staticClass:"unit-end-input",attrs:{placeholder:"100",size:"mini"},model:{value:t.endVal,callback:function(s){e.$set(t,"endVal",s)},expression:"item.endVal"}}),e._v(e._s(t.unit||"%")+"\n            ")],1)],1),a("el-row",{staticClass:"user-wrap"},[a("el-col",{attrs:{span:3}},[e._v("\n              谁可以看\n              "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"默认全员可见",placement:"top"}},[a("i",{staticClass:"iconfont icon-shuoming"})])],1),a("el-col",{staticClass:"flex",attrs:{span:21}},[e._l(t.users,(function(i,o){return a("div",{staticClass:"avatar",on:{click:function(t){return e.setKeyResultsitemPanelVisible(s)}}},[a("span",{directives:[{name:"show",rawName:"v-show",value:t.canView,expression:"item.canView"}],staticClass:"close",on:{click:function(e){e.stopPropagation()}}},[a("i",{staticClass:"iconfont icon-guanbi",on:{click:function(t){return e.removeMemberKeyResults(s,o)}}})]),i?a("avatar",{attrs:{user:i}}):e._e()],1)})),a("div",{directives:[{name:"show",rawName:"v-show",value:t.canView,expression:"item.canView"}]},[a("i",{staticClass:"iconfont icon-tianjia pointer fs-22",on:{click:function(t){return e.setKeyResultsitemPanelVisible(s)}}})]),a("member-panel",{attrs:{top:"-311px",left:"-275px",xKey:"users",visible:t.panelVisible,member:t.users},on:{close:e.closeMembersPanel}})],2)],1)],1)})),a("div",{staticClass:"w-100p"},[a("el-button",{staticClass:"fl",attrs:{type:"text"},on:{click:e.addKeyResult}},[e._v("+新增关键结果")]),a("div",{directives:[{name:"show",rawName:"v-show",value:"AC"===e.form.progressUpdateType,expression:"form.progressUpdateType==='AC'"}],staticClass:"fr"},[e._v("总权重："),a("span",{class:{danger:100!==e.form.totalWeight,green:100===e.form.totalWeight}},[e._v(e._s(e.form.totalWeight)+"%")])])],1)],2)]),a("el-form-item",{staticClass:"w-100p fl mt-15",attrs:{label:"父目标"}},[a("el-input",{staticStyle:{width:"90%"},attrs:{readonly:!0,placeholder:e.form.parent?e.form.parent.objName:"请选择父目标"},nativeOn:{click:function(t){return e.showParent.apply(null,arguments)}}}),a("span",{staticClass:"ml-10 pointer",on:{click:function(t){e.form.parent=""}}},[e._v("清除")])],1),a("div",{staticClass:"clear"}),a("div",{staticClass:"w-100p"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"new"===e.type,expression:"type==='new'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.saveTarget("new")}}},[e._v("确认")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"modify"===e.type||"publish"===e.type,expression:"type==='modify' || type==='publish'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.saveTarget("modify")}}},[e._v("保存")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"new"===e.type,expression:"type==='new'"}],attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.saveTarget("draft")}}},[e._v("保存为草稿")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"new"===e.type,expression:"type==='new'"}],attrs:{type:"primary",size:"mini",plain:""},on:{click:function(t){return e.saveTarget("communicate")}}},[e._v("目标沟通")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"publish"===e.type,expression:"type==='publish'"}],attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.saveTarget("publish")}}},[e._v("发布")]),a("el-button",{attrs:{type:"text"},on:{click:e.closePanel}},[e._v("取消")])],1)],1),a("el-dialog",{staticClass:"target-wrap",attrs:{visible:e.parent.dialogVisible,width:"500",top:"50px","append-to-body":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){return e.$set(e.parent,"dialogVisible",t)}}},[a("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"title"},[a("i",{staticClass:"iconfont icon-mubiao_pressed"}),e._v(" 父目标\n      ")]),a("div",{staticClass:"options"},[a("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.parent.dialogVisible=!1}}})]),a("div",{staticClass:"clear"})]),a("div",[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:"搜索目标名称、负责人"},on:{input:e.getList},model:{value:e.parent.searchKey,callback:function(t){e.$set(e.parent,"searchKey",t)},expression:"parent.searchKey"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),a("el-col",{attrs:{span:8}},[a("el-select",{staticClass:"w-100p",attrs:{placeholder:"目标类型"},on:{input:e.getList},model:{value:e.parent.objType,callback:function(t){e.$set(e.parent,"objType",t)},expression:"parent.objType"}},e._l(e.enumType.ObjectiveType,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}},[a("span",[e._v(e._s(t.name))])])})),1)],1)],1),e.parent.list&&e.parent.list.length>0?a("el-table",{staticClass:"mt-15",attrs:{data:e.parent.list,"cell-style":{background:"#fff",cursor:"pointer"},"header-cell-style":{background:"#eee"}},on:{"row-click":e.setParent}},[a("el-table-column",{attrs:{width:"160",label:"负责人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.parent.list[t.$index].objUser?a("div",{staticClass:"flex",staticStyle:{"line-height":"32px"}},[a("avatar",{attrs:{user:e.parent.list[t.$index].objUser}}),e._v("   "+e._s(e.parent.list[t.$index].objUser.userName)+"\n            ")],1):e._e()]}}],null,!1,1606752789)}),a("el-table-column",{attrs:{prop:"objName",label:"目标",width:"350"}}),a("el-table-column",{attrs:{label:"类型",prop:"objTypeDisplay"}})],1):e._e(),e.parent.list&&e.parent.list.length>0?a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{background:"","page-size":e.parent.pageSize,layout:"prev, pager, next",total:e.parent.total},on:{"current-change":e.handleCurrentChange}}):e._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:e.parent.list&&0===e.parent.list.length,expression:"parent.list && parent.list.length===0"}],staticClass:"w-100p gray txt-center"},[a("img",{attrs:{src:s("f244")}}),a("br"),a("span",{staticStyle:{"font-size":"14px"}},[e._v("暂无数据")]),a("br"),a("br")]),a("div",{staticClass:"clear"})],1)]),a("target-communicate",{attrs:{params:e.communicate,append:!0},on:{SEND_COMMUNICATE:e.onCommunicate}})],1)},i=[],o=(s("e680"),s("4ca0")),n=s("26aa"),r=s("7150"),l=s("40c4"),c=s("0837"),u=s("c4ce"),p={name:"targetEdit",props:{stage:Object,visible:{type:Boolean,default:function(){return!1}},append:{type:Boolean,default:function(){return!1}},type:String,id:String,detail:Object},components:{memberPanel:l["a"],avatar:r["a"],dialogPanel:c["a"],targetCommunicate:u["a"]},data:function(){return{panelVisible:!1,enumType:{},dialogVisible:!1,form:{progressUpdateType:"AC",objType:"",users:[],keyResults:[{canView:!0,unitType:"YN",weight:100,keyResult:"",users:[],panelVisible:!1,progressState:{name:"NM",value:"可控"},unit:"%",endVal:100,startVal:0}],parent:"",totalWeight:100},deptList:[],parent:{dialogVisible:!1,list:"",searchKey:"",objType:"",pageSize:10,pageNum:1,total:0},communicate:{users:[],panelVisible:!1,comment:{},msg:"",dialogVisible:!1,params:{}}}},computed:{user:function(){return this.$store.getters.user}},watch:{detail:function(e){e.objType?(this.form=e,this.sumWeight()):this.form={objType:"",progressUpdateType:"AC",users:[{userAvatar:this.user.user.jwtClaims.ua,userId:this.user.user.jwtClaims.id,userName:this.user.user.jwtClaims.un}],keyResults:[{canView:!0,unitType:"YN",weight:0,keyResult:"",users:[],panelVisible:!1,progressState:{name:"NM",value:"可控"},unit:"%",endVal:100,startVal:0}],parent:"",totalWeight:0},this.dialogVisible=!0}},mounted:function(){this.getEnum("ObjectiveType"),this.getDeptTree(),this.getList(),this.form.users=[{userAvatar:this.user.user.jwtClaims.ua,userId:this.user.user.jwtClaims.id,userName:this.user.user.jwtClaims.un}]},methods:{init:function(){},getEnum:function(e){var t=this;o["a"].getEnum(e).then((function(s){200===s.code&&t.$set(t.enumType,e,s.data)})).catch((function(e){console.log(e)}))},getDeptTree:function(){var e=this,t={withEntRoot:!0};n["a"].userDeptTree(t).then((function(t){200===t.code&&(e.deptList=e.setSelectDept(t.data,0))})).catch((function(e){console.log(e)}))},setSelectDept:function(e,t){var s=[];for(var a in e)s.push({deptName:e[a].deptName,deptId:e[a].deptId,level:t}),e[a].subDepts&&(e[a].subDepts=this.setSelectDept(e[a].subDepts,t+1)),s=s.concat(e[a].subDepts);return s},setUsers:function(e){e.data&&e.data.length>0&&(this.form.users=[e.data[e.data.length-1]]),this.panelVisible=!1},removeUsers:function(){this.form.users=[]},closeMembersPanel:function(){var e=this;setTimeout((function(){for(var t in e.panelVisible=!1,e.form.keyResults)e.$set(e.form.keyResults[t],"panelVisible",!1)}))},setKeyResultsitemPanelVisible:function(e){this.form.keyResults[e].canView&&this.$set(this.form.keyResults[e],"panelVisible",!0)},removeMemberKeyResults:function(e,t){this.form.keyResults[e].users.splice(t,1)},addKeyResult:function(){this.form.keyResults.push({canView:!0,unitType:"YN",weight:0,keyResult:"",users:[],panelVisible:!1,progressState:{name:"NM",value:"可控"},unit:"%",endVal:100,startVal:0}),this.sumWeight()},removeKeyResult:function(e){1===this.form.keyResults.length?this.$message.warning({message:"关键结果至少保留1个!",duration:1500}):this.form.keyResults.splice(e,1),this.sumWeight()},getList:function(){var e=this,t={filter:this.parent.searchKey,objType:this.parent.objType,parentObj:!0,periodId:this.stage.id,pageNum:this.parent.pageNum,pageSize:this.parent.pageSize};o["a"].objQueryPage(t).then((function(t){200===t.code&&(e.parent.list=t.data.list,e.parent.total=t.data.total)})).catch((function(e){console.log(e)}))},handleCurrentChange:function(e){this.parent.pageNum=e,this.getList()},showParent:function(){this.getList(),this.parent.dialogVisible=!0},setParent:function(e){console.log(e),console.log(this.id),e.objId!==this.id?(this.form.parent=e,this.parent.dialogVisible=!1):this.$message.warning({message:"不能选取为父目标！",duration:1500})},sumWeight:function(){var e=0;for(var t in this.form.keyResults)e+=Number(this.form.keyResults[t].weight);this.form.totalWeight=e},saveTarget:function(e){var t=this;this.$refs["form"].validate((function(s){if(s)if("DP"!==t.form.objType||t.form.deptId)if("AC"===t.form.progressUpdateType&&100!==t.form.totalWeight)t.$message.warning({message:"关键结果总权重须等于100%",duration:1500});else{for(var a in t.form.keyResults){if(t.form.keyResults[a].canView&&!t.form.keyResults[a].keyResult)return void t.$message.warning({message:"关键目标不能为空!",duration:1500});if("SD"===t.form.keyResults[a].unitType&&(t.form.keyResults[a].startVal<0||!t.form.keyResults[a].endVal||!t.form.keyResults[a].unit))return void t.$message.warning({message:"关键目标自定义单位填写不规范!",duration:1500})}var i={deptId:"DP"===t.form.objType?t.form.deptId:"",objName:t.form.objName,objParentId:t.form.parent?t.form.parent.objId:"",objType:t.form.objType,objUserId:t.form.users[0]?t.form.users[0].id||t.form.users[0].userId:"",periodId:t.stage.id,progressUpdateType:t.form.progressUpdateType},n=function(e){"YN"===t.form.keyResults[e].unitType?(i["keyResults["+e+"].keyResult"]=t.form.keyResults[e].keyResult,i["keyResults["+e+"].unitType"]=t.form.keyResults[e].unitType,i["keyResults["+e+"].weight"]=Number(t.form.keyResults[e].weight),i["keyResults["+e+"].startVal"]=0,i["keyResults["+e+"].endVal"]=100,i["keyResults["+e+"].unit"]="",i["keyResults["+e+"].userIds"]=function(){var s="";for(var a in t.form.keyResults[e].users){var i=t.form.keyResults[e].users[a].id||t.form.keyResults[e].users[a].userId;"-1"!==i&&(s+=i+",")}return s.length>0?s.substring(0,s.length-1):""}()):(i["keyResults["+e+"].keyResult"]=t.form.keyResults[e].keyResult,i["keyResults["+e+"].unitType"]=t.form.keyResults[e].unitType,i["keyResults["+e+"].weight"]=Number(t.form.keyResults[e].weight),i["keyResults["+e+"].startVal"]=Number(t.form.keyResults[e].startVal),i["keyResults["+e+"].endVal"]=Number(t.form.keyResults[e].endVal),i["keyResults["+e+"].unit"]=t.form.keyResults[e].unit,i["keyResults["+e+"].userIds"]=function(){var s="";for(var a in t.form.keyResults[e].users){var i=t.form.keyResults[e].users[a].id||t.form.keyResults[e].users[a].userId;"-1"!==i&&(s+=i+",")}return s.length>0?s.substring(0,s.length-1):""}()),"modify"===t.type&&(i["keyResults["+e+"].keyResultId"]=t.form.keyResults[e].keyResultId)};for(var r in t.form.keyResults)n(r);"draft"===e?o["a"].objAddDraft(i).then((function(e){200===e.code&&(t.$message.success({message:"保存目标草稿成功!",duration:1500}),t.targetEdit())})).catch((function(e){console.log(e)})):"communicate"===e?t.communicate={users:[],panelVisible:!1,comment:{},dialogVisible:!0,params:i,type:"communicate"}:"new"===e?o["a"].objAdd(i).then((function(e){200===e.code&&(t.$message.success({message:"新建目标成功!",duration:1500}),t.targetEdit())})).catch((function(e){console.log(e)})):"modify"===e?o["a"].objEdit(i,t.id).then((function(e){200===e.code&&(t.$message.success({message:"目标修改成功!",duration:1500}),t.targetEdit())})).catch((function(e){console.log(e)})):"publish"===e&&o["a"].objEdit(i,t.id).then((function(e){200===e.code&&t.publish()})).catch((function(e){console.log(e)}))}else t.$message.warning({message:"请选择部门!",duration:1500})}))},publish:function(){var e=this;o["a"].objPublish(this.id).then((function(t){200===t.code&&e.$confirm("草稿发布成功!是否要发系统消息通知他人?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((function(){e.communicate={users:[],panelVisible:!1,comment:{},dialogVisible:!0,params:{},type:"new",id:e.id,messageType:t.data.messageType.value,activities:t.data.activities}})).catch((function(t){e.targetEdit()}))})).catch((function(e){console.log(e)}))},closePanel:function(){this.dialogVisible=!1},onCommunicate:function(){this.dialogVisible=!1,this.$emit("modifyTarget")},targetEdit:function(){this.dialogVisible=!1,this.$emit("TARGET_EDIT")}}},m=p,d=s("4ac2"),g=Object(d["a"])(m,a,i,!1,null,"7bb4bd92",null);t["a"]=g.exports},"483c":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"target-wrap",attrs:{visible:e.visible,width:"600px","show-close":!1,"append-to-body":e.append,top:"50px"},on:{"update:visible":function(t){e.visible=t}}},[s("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-wodemubiao primary"}),e._v(" "+e._s(e.title)+"("+e._s(e.list.length)+")\n    ")]),s("div",{staticClass:"options"},[s("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.visible=!1}}})]),s("div",{staticClass:"clear"})]),s("div",{staticClass:"dialog-wrap"},[s("el-table",{attrs:{data:e.list,"header-cell-style":{background:"#f3f3f3"}}},[s("el-table-column",{attrs:{label:"员工",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.list[t.$index]?s("div",{staticClass:"flex",staticStyle:{"line-height":"32px"}},[s("avatar",{attrs:{user:e.list[t.$index]}}),e._v("   "+e._s(e.list[t.$index].userName)+"\n          ")],1):e._e()]}}])}),s("el-table-column",{attrs:{prop:"dept.deptName",label:"部门",width:"200"}}),s("el-table-column",{attrs:{prop:"position.name",label:"职位"}})],1)],1)])},i=[],o=s("7150"),n=s("4ca0"),r={name:"TargetMembers",props:{append:{type:Boolean,default:function(){return!1}},params:Object},components:{avatar:o["a"]},computed:{progressColor:function(){return this.$store.getters.progressColor}},data:function(){return{title:"",list:[],visible:!1,dialogVisible:!1,detail:{}}},watch:{params:function(e){e.params&&(console.log(e.params),"follow"===e.params.type?this.getFollow():this.getObjUsers())}},created:function(){},mounted:function(){},methods:{getFollow:function(){var e=this;this.title=this.params.title,this.list=[],n["a"].followList(this.params.params.id).then((function(t){200===t.code&&(e.list=t.data,e.visible=!0)})).catch((function(e){console.log(e)}))},getObjUsers:function(){var e=this;this.title=this.params.title,this.list=[],n["a"].objUsers(this.params.params).then((function(t){200===t.code&&(e.list=t.data,t.data&&t.data.length>0&&(e.visible=!0))})).catch((function(e){console.log(e)}))}}},l=r,c=s("4ac2"),u=Object(c["a"])(l,a,i,!1,null,"7b52f016",null);t["a"]=u.exports},"802d":function(e,t,s){"use strict";s("0d7a")},ade0:function(e,t,s){},b40e:function(e,t,s){},c4ce:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"target-wrap",attrs:{visible:e.dialogVisible,width:"500",top:"220px","append-to-body":"","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-mubiao_pressed"}),e._v(" "+e._s("communicate"===e.type?"沟通内容":"消息通知")+"\n    ")]),s("div",{staticClass:"options"},[s("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.dialogVisible=!1}}})]),s("div",{staticClass:"clear"})]),s("div",{staticClass:"form"},[s("div",{staticClass:"row",staticStyle:{height:"38px"}},[s("div",{staticClass:"label"},[e._v(e._s("communicate"===e.type?"沟通对象":"通知对象")+" ")]),s("div",{staticClass:"flex"},[e._l(e.users,(function(t,a){return s("div",{staticClass:"avatar",on:{click:function(t){e.panelVisible=!0}}},[s("span",{staticClass:"close",on:{click:function(e){e.stopPropagation()}}},[s("i",{staticClass:"iconfont icon-guanbi",on:{click:function(t){return e.removeUsers(a)}}})]),t?s("avatar",{attrs:{user:t}}):e._e()],1)})),s("div",{directives:[{name:"show",rawName:"v-show",value:e.users&&0===e.users.length,expression:"users && users.length===0"}]},[s("i",{staticClass:"iconfont icon-tianjia pointer fs-32",on:{click:function(t){e.panelVisible=!0}}})])],2),s("member-panel",{attrs:{top:"56px",left:"-260px",xKey:"team",visible:e.panelVisible,member:e.users},on:{selectDept:e.addDept,close:e.closePanel}})],1),s("el-row",{staticStyle:{padding:"15px","margin-top":"20px"},attrs:{gutter:20}},[s("el-col",{attrs:{span:1}},[s("div",{staticClass:"round-title"},[e.user?s("avatar",{attrs:{user:e.user}}):e._e()],1)]),s("el-col",{staticStyle:{"text-align":"left"},attrs:{span:19,offset:1}},[s("dialog-panel",{ref:"dialog",attrs:{comment:e.comment,tips:"沟通内容，文字上限2000。"},on:{setComment:e.setMsg}})],1),s("el-col",{attrs:{span:3}},[s("el-button",{attrs:{type:"primary"},on:{click:e.sendMsg}},[e._v("发送")])],1)],1)],1)])},i=[],o=s("7150"),n=s("40c4"),r=s("0837"),l=s("4ca0"),c={name:"targetCommunicate",props:{append:{type:Boolean,default:function(){return!1}},params:Object},components:{avatar:o["a"],memberPanel:n["a"],dialogPanel:r["a"]},computed:{},data:function(){return{draftParams:{},dialogVisible:!1,type:"",users:[],panelVisible:!1,comment:{content:"",attachments:[]},message:{},id:"",user:{userAvatar:this.$store.state.user.user.jwtClaims.ua,userId:this.$store.state.user.user.jwtClaims.id,userName:this.$store.state.user.user.jwtClaims.un}}},watch:{params:function(e){if(this.dialogVisible=e.dialogVisible,this.type=e.type,this.id=e.id,this.messageType=e.messageType,this.panelVisible=!1,this.draftParams=e.params,e.activities&&e.activities.length>0){var t,s='<div style="background: #efefef; padding: 10px 20px">';for(t in e.activities)s+="["+(parseInt(t)+1)+"]."+e.activities[t]+"<br/>";s+="</div><br/>",this.$set(this.comment,"content",s),this.setMsg(this.comment)}}},created:function(){},mounted:function(){},methods:{initParams:function(){this.dialogVisible=!1,this.type="",this.users=[],this.panelVisible=!1,this.comment={content:"",attachments:[]},this.message={},this.id=""},setMsg:function(e){this.message=e},closePanel:function(){this.panelVisible=!1},removeUsers:function(e){this.users.splice(e,1)},sendMsg:function(){"communicate"===this.type?this.sendCommunicateMsg():this.sendOperationMsg()},addDept:function(){},sendOperationMsg:function(){var e=this,t={bizType:"obj",content:this.message.content||"",messageType:this.messageType};for(var s in this.users)t.content+=' <span class="success">@'+this.users[s].userName+'<span style="display: none">[@u|'+this.users[s].id+"|"+this.users[s].userName+"]</span></span> ";if(this.message.attachments&&this.message.attachments.length>0)for(var a in this.message.attachments)t["attachments["+a+"]"]="https://dev-oss.cgvcap.com/file/"+this.message.attachments[a].fileId+"/"+this.message.attachments[a].accessCode;l["a"].addComment(t,this.id).then((function(t){200===t.code&&(e.initParams(),e.$emit("SEND_COMMUNICATE"),e.$message.success({message:"信息通知成功",duration:1500}))})).catch((function(e){console.log(e)}))},sendCommunicateMsg:function(){var e=this;l["a"].objAddDraft(this.draftParams).then((function(t){200===t.code&&l["a"].communicate(t.data).then((function(s){if(200===s.code){var a={bizType:"obj",content:e.message.content||""};for(var i in e.users)a.content+=' <span class="success">@'+e.users[i].userName+'<span style="display: none">[@u|'+e.users[i].id+"|"+e.users[i].userName+"]</span></span> ";if(e.message.attachments&&e.message.attachments.length>0)for(var o in e.message.attachments)a["attachments["+o+"]"]="https://dev-oss.cgvcap.com/file/"+e.message.attachments[o].fileId+"/"+e.message.attachments[o].accessCode;l["a"].addComment(a,t.data).then((function(t){200===t.code&&(e.initParams(),e.$emit("SEND_COMMUNICATE"),e.$message.success({message:"沟通信息传达成功",duration:1500}))})).catch((function(e){console.log(e)}))}})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}}},u=c,p=s("4ac2"),m=Object(p["a"])(u,a,i,!1,null,"a017f094",null);t["a"]=m.exports},cf89:function(e,t,s){"use strict";s("ade0")},e2e1:function(e,t,s){"use strict";s("b40e")}}]);