(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-13ff8852","chunk-d81f416c"],{1374:function(e,t,s){"use strict";var a=s("bb8b"),n=s("5edc");e.exports=function(e,t,s){t in e?a.f(e,t,n(0,s)):e[t]=s}},2559:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var a=s("9970"),n=s.n(a);function r(e,t,s){return t in e?n()(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}},"328f":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"users-wrap"},[e._l(e.users,(function(t,a){return s("div",{key:a,staticClass:"avatar",class:{step:e.step,last:a===e.users.length-1}},[s("span",{staticClass:"close",on:{click:function(e){e.stopPropagation()}}},[s("i",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],staticClass:"iconfont icon-guanbi",on:{click:function(t){return e.removeUser(a)}}})]),s("el-tooltip",{attrs:{content:t.userName,effect:"dark",placement:"top"}},[s("avatar",{attrs:{user:t}})],1),e.tags?s("div",{staticStyle:{"line-height":"16px","padding-top":"8px"}},[e._v(e._s(t.userTag||t.userName))]):e._e(),s("div",{staticClass:"line"})],1)})),s("div",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}]},[s("i",{staticClass:"iconfont icon-tianjia pointer fs-22",on:{click:function(t){return e.showMemberTransfer("transfer")}}})]),s("members-transfer",{ref:"transfer",attrs:{multi:e.multi,role:e.role,step:e.step,users:e.users,invest:e.invest},on:{SAVE_USERS:e.setUsers}})],2)},n=[],r=s("7150"),i=s("8995"),o={components:{avatar:r["a"],membersTransfer:i["a"]},model:{prop:"users",event:"change"},props:{users:Array,step:{type:Boolean,default:function(){return!1}},edit:{type:Boolean,default:function(){return!0}},multi:{type:Boolean,default:function(){return!0}},placement:{type:String,default:function(){return"top"}},role:{type:Boolean,default:function(){return!1}},tags:{type:Boolean,default:function(){return!1}},invest:{type:Boolean,default:function(){return!1}}},computed:{},data:function(){return{}},methods:{setUsers:function(e){this.$emit("change",e),this.$emit("SET_USERS",e)},showMemberTransfer:function(e){this.$refs[""+e].show()},removeUser:function(e){var t=this.users;t.splice(e,1)}}},l=o,c=(s("44df"),s("4ac2")),u=Object(c["a"])(l,a,n,!1,null,"45d72c07",null);t["a"]=u.exports},"32ea":function(e,t,s){var a=s("8078"),n=s("93ca");s("b2be")("keys",(function(){return function(e){return n(a(e))}}))},"44df":function(e,t,s){"use strict";s("bfe1")},"4a5e":function(e,t,s){"use strict";s("4e28")},"4e28":function(e,t,s){},6767:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",[s("el-header",{staticClass:"header"},[s("div",{staticClass:"header-wrap"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-liuchengpeizhi"}),e._v(" 流程配置\n\t\t\t\t")])])]),s("el-main",{staticClass:"main approve-setting"},[s("el-row",{staticClass:"header-wrap"},[s("el-col",{attrs:{span:5}},[e._v("审批名称")]),s("el-col",{attrs:{span:7}},[e._v("说明")]),s("el-col",{attrs:{span:5}},[e._v("审批人设置")]),s("el-col",{attrs:{span:5}},[e._v("抄送人设置")]),s("el-col",{attrs:{span:2}},[e._v("操作")])],1),s("div",{staticClass:"body"},[e._l(e.menu,(function(t){return[s("el-row",{key:t.groupId,class:{"has-border":!t.showChildren},attrs:{gutter:10}},[s("el-col",{attrs:{span:24}},[s("div",{staticClass:"title",on:{click:function(s){return e.setVisible(t)}}},[s("i",{staticClass:"iconfont",class:{"icon-shouqi4":!t.showChildren,"icon-gengduo":t.showChildren}}),e._v("\n\t\t\t\t\t\t\t\t"+e._s(t.groupName)+"（"+e._s(t.templates.length)+"）\n\t\t\t\t\t\t\t")])])],1),e._l(t.templates,(function(a){return[s("el-row",{directives:[{name:"show",rawName:"v-show",value:t.showChildren,expression:"tab.showChildren"}],key:a.templateId,staticClass:"detail",style:{height:a.subFollows&&a.subFollows.length>0&&a.showChildren?"auto":"48px"}},[s("el-col",{staticClass:"name",staticStyle:{cursor:"pointer"},attrs:{span:5},nativeOn:{click:function(e){a.showChildren=!a.showChildren}}},[a.subFollows&&a.subFollows.length>0?s("i",{staticClass:"iconfont",class:{"icon-shouqi4":!a.showChildren,"icon-gengduo":a.showChildren},staticStyle:{"margin-right":"10px"}}):e._e(),e._v("\n                "+e._s(a.templateName)+"\n\t\t\t\t\t\t\t")]),s("el-col",{staticClass:"desc",attrs:{span:7}},[e._v(e._s(a.templateDesc)+" ")]),s("el-col",{attrs:{span:5}},[s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showDialog(a,"approve")}}},[e._v("审批人")]),a.hasApproverSetting?s("span",[e._v("（已设置）")]):e._e()],1),s("el-col",{attrs:{span:5}},[s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showDialog(a,"copy")}}},[e._v("抄送人")]),a.hasCcSetting?s("span",[e._v("（已设置）")]):e._e()],1),s("el-col",{attrs:{span:2}},["NM"===a.templateState.value?s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.disable(a.templateId)}}},[e._v("停用")]):e._e(),"DA"===a.templateState.value?s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.enable(a.templateId)}}},[e._v("启用")]):e._e(),s("span",[e._v(" | ")]),s("el-button",{attrs:{type:"text"},on:{click:function(t){return e.openGrantDialog(a.templateId)}}},[e._v("授权")])],1),e._l(a.subFollows,(function(t){return[s("el-col",{directives:[{name:"show",rawName:"v-show",value:a.showChildren,expression:"item.showChildren"}],attrs:{span:24}},[s("el-row",{key:t.templateId,staticClass:"detail"},[s("el-col",{staticClass:"name",staticStyle:{"padding-left":"48px"},attrs:{span:5}},[e._v("\n                      "+e._s(t.templateName)+"\n                    ")]),s("el-col",{staticClass:"desc",attrs:{span:7}},[e._v(e._s(t.templateDesc)+" ")]),s("el-col",{attrs:{span:5}},[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showDialog(t,"approve")}}},[e._v("审批人")]),t.hasApproverSetting?s("span",[e._v("（已设置）")]):e._e()],1),s("el-col",{attrs:{span:5}},[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showDialog(t,"copy")}}},[e._v("抄送人")]),t.hasCcSetting?s("span",[e._v("（已设置）")]):e._e()],1),s("el-col",{attrs:{span:2}},["NM"===t.templateState.value?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.disable(t.templateId)}}},[e._v("停用")]):e._e(),"DA"===t.templateState.value?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.enable(t.templateId)}}},[e._v("启用")]):e._e()],1)],1)],1)]}))],2)]}))]}))],2)],1),s("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,visible:e.usersDialogVisible,top:"50px",width:"600px"},on:{"update:visible":function(t){e.usersDialogVisible=t}}},[s("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-shenpi_normal"}),e._v("\n\t\t\t\t\t "+e._s("approve"===e.curSetType?"审批人设置":"抄送人设置")+"\n\t\t\t\t")]),s("div",{staticClass:"options"},[s("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.usersDialogVisible=!1}}})]),s("div",{staticClass:"clear"})]),s("el-form",{ref:"detail",attrs:{model:e.form,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"审批名称："}},[e._v(e._s(e.form.templateName))]),"approve"===e.curSetType?s("el-form-item",{attrs:{label:"审批流程："}},[s("div",[s("el-radio",{attrs:{label:"FE"},model:{value:e.form.approvalType,callback:function(t){e.$set(e.form,"approvalType",t)},expression:"form.approvalType"}},[e._v("自由流程 （流程发起人可自行添加相应的审批人）")])],1),s("div",[s("el-radio",{attrs:{label:"FX"},model:{value:e.form.approvalType,callback:function(t){e.$set(e.form,"approvalType",t)},expression:"form.approvalType"}},[e._v("固定流程 （流程发起人需按照规定好的审批人流程进行审批）")]),s("el-button",{directives:[{name:"show",rawName:"v-show",value:"FX"===e.form.approvalType,expression:"form.approvalType === 'FX'"}],attrs:{type:"text"},on:{click:function(t){return e.showMemberTransfer("transfer")}}},[e._v("设置")])],1)]):e._e(),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"FX"===e.form.approvalType&&e.form.users.length>0,expression:"form.approvalType === 'FX' && form.users.length > 0"}],attrs:{label:""}},[s("user-select",{attrs:{edit:!1,step:!0,tags:!0,users:e.form.users}})],1),"approve"===e.curSetType?s("el-form-item",{attrs:{label:"审批提醒："}},[s("el-checkbox-group",{model:{value:e.form.reminderTypes,callback:function(t){e.$set(e.form,"reminderTypes",t)},expression:"form.reminderTypes"}},e._l(e.reminderTypes,(function(t){return s("el-checkbox",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.name))])})),1)],1):e._e(),"copy"===e.curSetType?s("el-form-item",{attrs:{label:"提醒方式："}},[s("el-radio-group",{model:{value:e.form.reminderWay,callback:function(t){e.$set(e.form,"reminderWay",t)},expression:"form.reminderWay"}},e._l(e.reminderWays,(function(t){return s("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.name))])})),1)],1):e._e(),"copy"===e.curSetType?s("el-form-item",{attrs:{label:"抄送人："}},[s("user-select",{attrs:{users:e.form.users},on:{SET_USERS:e.setUsers}})],1):e._e(),s("el-form-item",{attrs:{label:""}},[s("div",{staticClass:"w-100p",staticStyle:{"text-align":"left"}},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.save()}}},[e._v("确认")]),s("el-button",{attrs:{size:"mini",type:"default"},on:{click:function(t){e.usersDialogVisible=!1}}},[e._v("取消")])],1)])],1)],1),s("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,visible:e.grantDialogVisible,top:"50px",width:"600px"},on:{"update:visible":function(t){e.grantDialogVisible=t}}},[s("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[s("div",{staticClass:"title"},[s("i",{staticClass:"iconfont icon-shenpi_normal"}),s("span",{staticClass:"dialog-header__title"},[e._v(" 授权")])]),s("div",{staticClass:"options"},[s("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){e.grantDialogVisible=!1}}})]),s("div",{staticClass:"clear"})]),s("div",{staticStyle:{"min-height":"200px"}},[s("div",[s("span",{staticStyle:{color:"#F67B7B","margin-right":"4px"}},[e._v("*")]),s("span",[e._v("权限设置（不设置时，默认所有人都可以发起此审批）")])]),s("div",{staticStyle:{padding:"20px 40px"}},[s("user-select",{attrs:{users:e.grants},on:{SET_USERS:e.setGrants}})],1)]),s("div",{staticClass:"w-100p"},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.grant()}}},[e._v("确认")]),s("el-button",{attrs:{size:"mini",type:"default"},on:{click:function(t){e.grantDialogVisible=!1}}},[e._v("取消")])],1)]),s("members-transfer",{ref:"transfer",attrs:{role:!0,step:e.step,users:e.form.users},on:{SAVE_USERS:e.setUsers}})],1)},n=[],r=(s("ac67"),s("1bc7"),s("32ea"),s("2559")),i=s("b429"),o=s("328f"),l=s("8995");function c(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function u(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?c(Object(s),!0).forEach((function(t){Object(r["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var p=[{name:"系统消息",value:"SM"},{name:"手机短信",value:"SR"}],f=[{name:"仅全部同意后通知",value:"AP"},{name:"仅发起时通知",value:"OS"},{name:"发起时和全部同意后通知",value:"SP"}],d={components:{userSelect:o["a"],membersTransfer:l["a"]},computed:{},data:function(){return{baseAPI:"https://dev-api.cgvcap.com",menu:[],step:!1,curSetType:"",form:{},usersDialogVisible:!1,grantDialogVisible:!1,reminderTypes:p,reminderWays:f,grants:[],grantId:"",curItem:null}},mounted:function(){this.getList()},methods:{getList:function(){var e=this;i["a"].getTemplates().then((function(t){e.menu=t.data.map((function(e){return e.showChildren=!1,e.templates.map((function(e){e.showChildren=!1,e.subFollows.length>0&&console.log(e)})),e}))}))},setVisible:function(e){e.showChildren=!e.showChildren},disable:function(e){var t=this;i["a"].disableTemplate(e).then((function(e){t.getList()}))},enable:function(e){var t=this;i["a"].enableTemplate(e).then((function(e){t.getList()}))},showDialog:function(e,t){var s=this;this.curItem=e,this.curSetType=t,"approve"===t?i["a"].getApprover(e.templateId).then((function(e){if(e.success){var t=e.data,a=t.templateId,n=t.templateName,r=t.reminderTypes,i=t.approvalNodes,o=t.approvalType;s.form={templateId:a,templateName:n,reminderTypes:r.map((function(e){return e.value})),users:i.map((function(e){var t=e.nodeName,s=e.nodeId,a=e.nodeRefId,n=e.nodeType;return{userName:t,nodeId:s||"",userId:a,nodeType:n.value,userTag:t}})),approvalType:o.value},s.usersDialogVisible=!0}})):i["a"].getCcSetting(e.templateId).then((function(e){if(e.success){var t=e.data,a=t.templateName,n=t.templateId,r=t.ccUsers,i=t.reminderWay;s.form={templateId:n,templateName:a,users:r,reminderWay:i.value},s.usersDialogVisible=!0}}))},setUsers:function(e){this.form.users=e.map((function(e){return u(u({},e),{},{userTag:e.userName})}))},showMemberTransfer:function(e){this.step="approve"===this.curSetType,this.$refs[""+e].show()},save:function(){var e=this;if("approve"===this.curSetType){var t=this.form,s=t.templateId,a=t.approvalType,n=t.reminderTypes,r=this.form.users.map((function(e){return{nodeId:e.nodeId,nodeName:e.userName,nodeRefId:e.id||e.userId,nodeType:e.nodeType?e.nodeType:e.roleName?"RN":"UN"}}));i["a"].setApprover(s,{approvalNodes:r,approvalType:a,reminderTypes:n}).then((function(t){t.success&&(e.curItem.hasApproverSetting=!0,e.usersDialogVisible=!1)}))}else{var o=this.form,l=o.templateId,c=o.users,u=o.reminderWay;i["a"].setCcSetting(l,{ccUserIds:c.map((function(e){return e.userId||e.id})),reminderWay:u}).then((function(t){e.curItem.hasCcSetting=!0,e.usersDialogVisible=!1}))}},openGrantDialog:function(e){var t=this;this.grantId=e,this.grantDialogVisible=!0,i["a"].geGrants(e).then((function(e){t.grantedUsers=e.success?e.data.grantedUsers:[],t.setGrants(t.grantedUsers)}))},grant:function(){var e=this,t=[];this.grants.map((function(e){t.push(e.id||e.userId)}));var s={grantUserIds:t};i["a"].setGrants(this.grantId,s).then((function(t){t.success&&(e.$message.success({message:"操作成功！",duration:1500}),e.grantDialogVisible=!1)}))},setGrants:function(e){this.grants=e}}},m=d,v=(s("4a5e"),s("4ac2")),h=Object(v["a"])(m,a,n,!1,null,"40c62240",null);t["default"]=h.exports},9970:function(e,t,s){e.exports=s("f263")},ac67:function(e,t,s){var a=s("e99b"),n=s("e7c8"),r=s("3471"),i=s("285b"),o=s("1374");a(a.S,"Object",{getOwnPropertyDescriptors:function(e){var t,s,a=r(e),l=i.f,c=n(a),u={},p=0;while(c.length>p)s=l(a,t=c[p++]),void 0!==s&&o(u,t,s);return u}})},b2be:function(e,t,s){var a=s("e99b"),n=s("76e3"),r=s("0926");e.exports=function(e,t){var s=(n.Object||{})[e]||Object[e],i={};i[e]=t(s),a(a.S+a.F*r((function(){s(1)})),"Object",i)}},bfe1:function(e,t,s){},e7c8:function(e,t,s){var a=s("21d9"),n=s("0c29"),r=s("a86f"),i=s("0b34").Reflect;e.exports=i&&i.ownKeys||function(e){var t=a.f(r(e)),s=n.f;return s?t.concat(s(e)):t}},ee68:function(e,t,s){var a=s("7c2b");a(a.S+a.F*!s("5e9e"),"Object",{defineProperty:s("597a").f})},f263:function(e,t,s){s("ee68");var a=s("ce99").Object;e.exports=function(e,t,s){return a.defineProperty(e,t,s)}}}]);