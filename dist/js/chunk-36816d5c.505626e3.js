(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36816d5c","chunk-d81f416c"],{"328f":function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"users-wrap"},[t._l(t.users,(function(e,s){return i("div",{key:s,staticClass:"avatar",class:{step:t.step,last:s===t.users.length-1}},[i("span",{staticClass:"close",on:{click:function(t){t.stopPropagation()}}},[i("i",{directives:[{name:"show",rawName:"v-show",value:t.edit,expression:"edit"}],staticClass:"iconfont icon-guanbi",on:{click:function(e){return t.removeUser(s)}}})]),i("el-tooltip",{attrs:{content:e.userName,effect:"dark",placement:"top"}},[i("avatar",{attrs:{user:e}})],1),t.tags?i("div",{staticStyle:{"line-height":"16px","padding-top":"8px"}},[t._v(t._s(e.userTag||e.userName))]):t._e(),i("div",{staticClass:"line"})],1)})),i("div",{directives:[{name:"show",rawName:"v-show",value:t.edit,expression:"edit"}]},[i("i",{staticClass:"iconfont icon-tianjia pointer fs-22",on:{click:function(e){return t.showMemberTransfer("transfer")}}})]),i("members-transfer",{ref:"transfer",attrs:{multi:t.multi,role:t.role,step:t.step,users:t.users,invest:t.invest},on:{SAVE_USERS:t.setUsers}})],2)},n=[],a=i("7150"),o=i("8995"),l={components:{avatar:a["a"],membersTransfer:o["a"]},model:{prop:"users",event:"change"},props:{users:Array,step:{type:Boolean,default:function(){return!1}},edit:{type:Boolean,default:function(){return!0}},multi:{type:Boolean,default:function(){return!0}},placement:{type:String,default:function(){return"top"}},role:{type:Boolean,default:function(){return!1}},tags:{type:Boolean,default:function(){return!1}},invest:{type:Boolean,default:function(){return!1}}},computed:{},data:function(){return{}},methods:{setUsers:function(t){this.$emit("change",t),this.$emit("SET_USERS",t)},showMemberTransfer:function(t){this.$refs[""+t].show()},removeUser:function(t){var e=this.users;e.splice(t,1)}}},r=l,c=(i("44df"),i("4ac2")),d=Object(c["a"])(r,s,n,!1,null,"45d72c07",null);e["a"]=d.exports},"32ea":function(t,e,i){var s=i("8078"),n=i("93ca");i("b2be")("keys",(function(){return function(t){return n(s(t))}}))},3441:function(t,e,i){"use strict";var s=i("e99b"),n=i("3250"),a=i("8078"),o=i("0926"),l=[].sort,r=[1,2,3];s(s.P+s.F*(o((function(){r.sort(void 0)}))||!o((function(){r.sort(null)}))||!i("95b6")(l)),"Array",{sort:function(t){return void 0===t?l.call(a(this)):l.call(a(this),n(t))}})},"34fe":function(t,e,i){},"44df":function(t,e,i){"use strict";i("bfe1")},5866:function(t,e,i){"use strict";i("7f2c0")},"7f2c0":function(t,e,i){},"891b":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.item.isShare?t._e():i("el-button",{attrs:{type:"text"},on:{click:t.showDialog}},[i("i",{staticClass:"iconfont icon-gongxiang1",staticStyle:{"margin-right":"5px"}}),t._v("共享")]),t.item.isShare?i("el-button",{attrs:{type:"text"},on:{click:t.showDialog}},[i("i",{staticClass:"iconfont icon-bianji1",staticStyle:{"margin-right":"5px"}}),t._v("编辑共享")]):t._e(),t.item.isShare?i("el-button",{attrs:{type:"text"},on:{click:function(e){return t.save(!0)}}},[i("i",{staticClass:"iconfont icon-quxiaogongxiang1",staticStyle:{"margin-right":"5px"}}),t._v("取消共享")]):t._e(),i("el-dialog",{attrs:{visible:t.dialogVisible,width:"550px","append-to-body":!0,"show-close":!1,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"title"},[i("i",{staticClass:"iconfont icon-xiangmuguanli"}),t._v(" 共享操作\n      ")]),i("div",{staticClass:"options",staticStyle:{display:"flex","align-items":"center"}},[i("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(e){return t.hideDialog()}}})]),i("div",{staticClass:"clear"})]),i("div",{staticClass:"main-wrap"},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("div",[t._v("共享成员及权限")]),i("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"text"},on:{click:function(e){t.tipsDialogVisible=!0}}},[t._v("权限说明")])],1),i("el-form",{ref:"detail",attrs:{model:t.detail,"label-width":"60px"}},[i("el-form-item",{attrs:{label:"可编辑"}},[i("div",{staticClass:"flex-wrap"},[i("div",{staticClass:"content"},t._l(t.detail.edit,(function(e,s){return i("div",{key:s,staticClass:"item"},[t._v("\n                "+t._s(e.name)+"\n                "),i("i",{staticClass:"iconfont icon-bohui",staticStyle:{cursor:"pointer",color:"#aaa","font-size":"12px","margin-left":"3px"},on:{click:function(e){return t.remove(s,"edit")}}})])})),0),i("div",{staticClass:"btn"},[i("el-dropdown",[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"iconfont icon-jindubaogao",staticStyle:{cursor:"pointer"}})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(e){return t.setAll("edit")}}},[t._v("所有人")]),i("el-dropdown-item",{nativeOn:{click:function(e){return t.openDept("edit")}}},[t._v("选择部门")]),i("el-dropdown-item",{nativeOn:{click:function(e){return t.openUser("edit")}}},[t._v("选择人员")])],1)],1)],1)])]),i("el-form-item",{attrs:{label:"可上传"}},[i("div",{staticClass:"flex-wrap"},[i("div",{staticClass:"content"},t._l(t.detail.upload,(function(e,s){return i("div",{key:s,staticClass:"item"},[t._v("\n                "+t._s(e.name)+"\n                "),i("i",{staticClass:"iconfont icon-bohui",staticStyle:{cursor:"pointer",color:"#aaa","font-size":"12px","margin-left":"3px"},on:{click:function(e){return t.remove(s,"upload")}}})])})),0),i("div",{staticClass:"btn"},[i("el-dropdown",[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"iconfont icon-jindubaogao",staticStyle:{cursor:"pointer"}})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(e){return t.setAll("upload")}}},[t._v("所有人")]),i("el-dropdown-item",{nativeOn:{click:function(e){return t.openDept("upload")}}},[t._v("选择部门")]),i("el-dropdown-item",{nativeOn:{click:function(e){return t.openUser("upload")}}},[t._v("选择人员")])],1)],1)],1)])]),i("el-form-item",{attrs:{label:"可查看"}},[i("div",{staticClass:"flex-wrap"},[i("div",{staticClass:"content"},t._l(t.detail.view,(function(e,s){return i("div",{key:s,staticClass:"item"},[t._v("\n                "+t._s(e.name)+"\n                "),i("i",{staticClass:"iconfont icon-bohui",staticStyle:{cursor:"pointer",color:"#aaa","font-size":"12px","margin-left":"3px"},on:{click:function(e){return t.remove(s,"view")}}})])})),0),i("div",{staticClass:"btn"},[i("el-dropdown",[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"iconfont icon-jindubaogao",staticStyle:{cursor:"pointer"}})]),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(e){return t.setAll("view")}}},[t._v("所有人")]),i("el-dropdown-item",{nativeOn:{click:function(e){return t.openDept("view")}}},[t._v("选择部门")]),i("el-dropdown-item",{nativeOn:{click:function(e){return t.openUser("view")}}},[t._v("选择人员")])],1)],1)],1)])]),i("el-form-item",{attrs:{label:""}},[i("div",{staticClass:"w-100p",staticStyle:{"text-align":"left"}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.save()}}},[t._v("确认")]),i("el-button",{attrs:{type:"default",size:"mini"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)])],1)],1)]),i("el-dialog",{attrs:{visible:t.tipsDialogVisible,width:"450px","append-to-body":!0,"show-close":!1,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.tipsDialogVisible=e}}},[i("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"title"},[i("i",{staticClass:"iconfont icon-xiangmuguanli"}),t._v(" 权限说明\n      ")]),i("div",{staticClass:"options",staticStyle:{display:"flex","align-items":"center"}},[i("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(e){t.tipsDialogVisible=!1}}})]),i("div",{staticClass:"clear"})]),i("div",{staticClass:"main-wrap"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tips,"header-cell-style":{background:"#fdfdfd"}}},[i("el-table-column",{attrs:{label:"权限",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.name)+"\n          ")]}}])}),i("el-table-column",{attrs:{label:"可以编辑"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.edit?i("div",{staticStyle:{width:"100%",display:"flex","justify-content":"center"}},[i("div",{staticStyle:{width:"10px",height:"10px","border-radius":"10px",background:"#77bc72"}})]):t._e()]}}])}),i("el-table-column",{attrs:{label:"可以上传"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.upload?i("div",{staticStyle:{width:"100%",display:"flex","justify-content":"center"}},[i("div",{staticStyle:{width:"10px",height:"10px","border-radius":"10px",background:"#77bc72"}})]):t._e()]}}])}),i("el-table-column",{attrs:{label:"可以查看"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.view?i("div",{staticStyle:{width:"100%",display:"flex","justify-content":"center"}},[i("div",{staticStyle:{width:"10px",height:"10px","border-radius":"10px",background:"#77bc72"}})]):t._e()]}}])})],1)],1)]),i("members-transfer",{ref:"transfer",attrs:{multi:!0,role:!1,step:!1,users:[],invest:!1},on:{SAVE_USERS:t.setUsers}}),i("dept-transfer",{ref:"deptTransfer",attrs:{multi:!0,role:!1,step:!1,depts:[]},on:{SAVE_DEPTS:t.setDepts}})],1)},n=[],a=(i("e680"),i("3441"),i("1bc7"),i("32ea"),i("1f6d")),o=(i("cd05"),i("328f")),l=i("8995"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"members-wrap",attrs:{visible:t.dialogVisible,width:"400px","show-close":!1,"append-to-body":!0,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"title"},[i("i",{staticClass:"iconfont icon-chengyuanjianbao1 primary"}),t._v(" 选择部门\n      ")]),i("div",{staticClass:"options"},[i("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(e){t.dialogVisible=!1}}})]),i("div",{staticClass:"clear"})]),i("div",{staticClass:"members-body"},[i("div",{staticClass:"from"},[i("div",{staticClass:"content"},[i("div",{staticStyle:{width:"100%",height:"15px"}}),t.showTree?i("el-tree",{ref:"dept",attrs:{data:t.list,props:t.defaultDeptProps,"node-key":"id","default-expand-all":!0},on:{"node-click":t.pickDept},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.node,n=e.data;return i("div",{staticClass:"custom-tree-node"},[i("div",{staticClass:"name"},[i("span",{staticStyle:{"margin-right":"auto"}},[t._v(t._s(s.label))]),i("i",{directives:[{name:"show",rawName:"v-show",value:n.checked,expression:"data.checked"}],staticClass:"iconfont icon-check"})])])}}],null,!1,2694894858)}):t._e()],1)])]),i("div",{staticClass:"members-footer"},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.save}},[t._v("确认")]),i("el-button",{attrs:{type:"default",size:"mini"},on:{click:t.cancel}},[t._v("取消")])],1)])},c=[],d=i("7150"),u=i("26aa"),p=(i("3528"),i("ed08")),f={name:"DeptPanelTransfer",components:{avatar:d["a"]},props:{depts:Array,multi:{type:Boolean,default:function(){return!0}},filter:{type:Array,default:function(){return[]}}},computed:{userDeptList:function(){return this.$store.getters.userDeptList}},data:function(){return{defaultDeptProps:{children:"children",label:"userName"},list:[],showTree:!0,dialogVisible:!1}},mounted:function(){this.init()},methods:{init:function(){var t=this;this.userDeptList?this.list=this.setDeptTree(JSON.parse(this.userDeptList)):u["a"].userDeptTree({}).then((function(e){200===e.code?(t.$store.dispatch("SetUserDeptList",JSON.stringify(e.data)),t.list=t.setDeptTree(e.data)):t.$message.warning({message:e.msg,duration:1500})})).catch((function(e){t.$message.error({message:JSON.stringify(e),duration:1500})}))},setDeptTree:function(t){var e=[];for(var i in t)t[i].subDepts&&t[i].subDepts.length>0&&(t[i].subDepts=this.setDeptTree(t[i].subDepts)),e.push({userName:t[i].deptName,noAvatar:!0,children:t[i].subDepts,deptId:t[i].deptId});return e},pickDept:function(t){var e=this;for(var i in this.showTree=!1,this.result)if(this.result[i].deptId===t.deptId)return t.checked=!1,this.result.splice(i,1),void this.$nextTick((function(){e.showTree=!0}));t.checked=!0,this.result.push(t),this.$nextTick((function(){e.showTree=!0}))},resetDeptTags:function(){this.tabs[1].data=this.setTreeChecked(this.tabs[1].data,!0),this.tabs[1].data=this.setTreeChecked(this.tabs[1].data,!1)},setTreeChecked:function(t,e){var i=t;for(var s in i)if(i[s].noAvatar&&i[s].children&&i[s].children.length>0)this.setTreeChecked(i[s].children,e);else if(e)i[s].checked=!1;else for(var n in this.result)i[s].checked||i[s].userId!==this.result[n].id&&i[s].userId!==this.result[n].userId||(i[s].checked=!0);return i},show:function(){this.result=p["a"].deepCopy(this.users)||[],this.init(),this.dialogVisible=!0},save:function(){this.dialogVisible=!1,this.$emit("SAVE_DEPTS",this.result)},cancel:function(){this.dialogVisible=!1}}},h=f,v=(i("5866"),i("4ac2")),m=Object(v["a"])(h,r,c,!1,null,null,null),b=m.exports,y={name:"",components:{userSelect:o["a"],membersTransfer:l["a"],deptTransfer:b},props:{item:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!1,detail:{edit:[],upload:[],view:[]},type:"",tipsDialogVisible:!1,tips:[{name:"查看/下载/分享",edit:!0,upload:!0,view:!0},{name:"新建/上传",edit:!0,upload:!0,view:!1},{name:"复制",edit:!0,upload:!0,view:!0},{name:"移动/重命名",edit:!0,upload:!1,view:!1},{name:"删除自己的",edit:!0,upload:!0,view:!1},{name:"删除别人的",edit:!0,upload:!1,view:!1},{name:"还原已删",edit:!0,upload:!1,view:!1}]}},mounted:function(){},methods:{showDialog:function(){var t=this;if(this.dialogVisible=!0,this.item.isShare){var e={typedId:this.item.typedId};a["a"].getShareDetail(e).then((function(e){200===e.code&&(e.data.allCanEdit&&t.detail.edit.push({name:"所有人",value:"all",type:"all"}),e.data.allCanUpload&&t.detail.upload.push({name:"所有人",value:"all",type:"all"}),e.data.allCanView&&t.detail.view.push({name:"所有人",value:"all",type:"all"}),e.data.deptConfig.canEditDepts.map((function(e){e.name=e.deptName,e.value=e.deptId,e.type="dept",t.detail.edit.push(e)})),e.data.deptConfig.canUploadDepts.map((function(e){e.name=e.deptName,e.value=e.deptId,e.type="dept",t.detail.upload.push(e)})),e.data.deptConfig.canViewDepts.map((function(e){e.name=e.deptName,e.value=e.deptId,e.type="dept",t.detail.view.push(e)})),e.data.userConfig.canEditUsers.map((function(e){e.name=e.userName,e.value=e.userId,e.type="user",t.detail.edit.push(e)})),e.data.userConfig.canUploadUsers.map((function(e){e.name=e.userName,e.value=e.userId,e.type="user",t.detail.upload.push(e)})),e.data.userConfig.canViewUsers.map((function(e){e.name=e.userName,e.value=e.userId,e.type="user",t.detail.view.push(e)})))})).catch((function(t){console.log(t)}))}else this.detail={edit:[],upload:[],view:[]}},hideDialog:function(){this.dialogVisible=!1},save:function(t){var e=this,i={typedId:this.item.typedId,allCanEdit:!1,allCanUpload:!1,allCanView:!1,deptConfig:{canEditIds:[],canUploadIds:[],canViewIds:[]},userConfig:{canEditIds:[],canUploadIds:[],canViewIds:[]}};t||(this.detail.edit.map((function(t){"all"===t.type&&(i.allCanEdit=!0),"user"===t.type&&i.userConfig.canEditIds.push(t.value),"dept"===t.type&&i.deptConfig.canEditIds.push(t.value)})),this.detail.upload.map((function(t){"all"===t.type&&(i.allCanUpload=!0),"user"===t.type&&i.userConfig.canUploadIds.push(t.value),"dept"===t.type&&(console.log(t),i.deptConfig.canUploadIds.push(t.value))})),this.detail.view.map((function(t){"all"===t.type&&(i.allCanView=!0),"user"===t.type&&i.userConfig.canViewIds.push(t.value),"dept"===t.type&&(console.log(t),i.deptConfig.canViewIds.push(t.value))}))),a["a"].saveShare(i).then((function(t){200===t.code&&(e.$message.success({message:"操作成功！",duration:1500}),e.hideDialog(),e.$emit("REFRESH"))})).catch((function(t){console.log(t)}))},remove:function(t,e){this.detail[e].splice(t,1)},openUser:function(t){this.type=t,this.$refs.transfer.show()},openDept:function(t){this.type=t,this.$refs.deptTransfer.show()},setUsers:function(t){var e=this;t.map((function(t){t.name=t.userName,t.value=t.userId||t.id,t.type="user",e.detail[e.type].push(t)})),this.detail[this.type]=this.deleteObject(this.detail[this.type])},setDepts:function(t){var e=this;t.map((function(t){t.name=t.userName,t.value=t.deptId,t.type="dept",e.detail[e.type].push(t)})),this.detail[this.type]=this.deleteObject(this.detail[this.type])},setAll:function(t){this.type=t,this.detail[this.type].push({name:"所有人",value:"all",type:"all"}),this.detail[this.type]=this.deleteObject(this.detail[this.type])},deleteObject:function(t){for(var e=[],i={},s=0;s<t.length;s++){var n=Object.keys(t[s]);n.sort((function(t,e){return Number(t)-Number(e)}));for(var a="",o=0;o<n.length;o++)a+=JSON.stringify(n[o]),a+=JSON.stringify(t[s][n[o]]);i.hasOwnProperty(a)||(e.push(t[s]),i[a]=!0)}return e}}},g=y,w=(i("a424"),Object(v["a"])(g,s,n,!1,null,"728b34fb",null));e["default"]=w.exports},"95b6":function(t,e,i){"use strict";var s=i("0926");t.exports=function(t,e){return!!t&&s((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},a424:function(t,e,i){"use strict";i("34fe")},b2be:function(t,e,i){var s=i("e99b"),n=i("76e3"),a=i("0926");t.exports=function(t,e){var i=(n.Object||{})[t]||Object[t],o={};o[t]=e(i),s(s.S+s.F*a((function(){i(1)})),"Object",o)}},bfe1:function(t,e,i){},cd05:function(t,e,i){"use strict";var s=i("b775");e["a"]={getEnum:function(t){return Object(s["a"])({url:"/enum/"+t,method:"get"})},deptTree:function(t){return Object(s["a"])({url:"/contacts/deptUserTree",method:"get",params:t})},getStatFinanceList:function(t){return Object(s["a"])({url:"/schedule/stat/cb/finance/list",method:"post",data:t})},updateStatFinanceList:function(t,e){return Object(s["a"])({url:"/schedule/stat/cb/finance/"+e+"/update",method:"post",data:t,headers:{"Content-Type":"application/json; charset=utf-8"}})},exportExcelCatering:function(t){return Object(s["a"])({url:"/schedule/stat/cb/finance/export",method:"get",params:t,responseType:"arraybuffer"})}}}}]);