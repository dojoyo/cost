(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c4107196","chunk-d81f416c"],{"1a44":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.item.isShare?e._e():a("el-button",{attrs:{type:"text"},on:{click:e.showDialog}},[a("i",{staticClass:"iconfont icon-fenxiangzhuanfax"}),e._v("共享")]),e.item.isShare?a("el-button",{attrs:{type:"text"},on:{click:e.showDialog}},[a("i",{staticClass:"iconfont icon-fenxiangzhuanfax",staticStyle:{"margin-right":"15px"}}),e._v("编辑共享")]):e._e(),e.item.isShare?a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.save(!0)}}},[a("i",{staticClass:"iconfont icon-fenxiangzhuanfax"}),e._v("取消共享")]):e._e(),a("el-dialog",{attrs:{visible:e.dialogVisible,width:"850px","append-to-body":!0,"show-close":!1,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"title"},[a("i",{staticClass:"iconfont icon-xiangmuguanli"}),e._v(" 共享操作\n        ")]),a("div",{staticClass:"options",staticStyle:{display:"flex","align-items":"center"}},[a("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(t){return e.hideDialog()}}})]),a("div",{staticClass:"clear"})]),a("div",{staticClass:"main-wrap"},[a("el-form",{ref:"detail",attrs:{model:e.detail,"label-width":"180px"}},[a("el-form-item",{attrs:{label:"共享方式"}},e._l(e.list,(function(t,i){return a("el-checkbox",{key:i,model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"item.checked"}},[e._v(e._s(t.name))])})),1),e.list[0].checked?a("div",[a("el-form-item",{attrs:{label:"全局操作"}},[a("el-checkbox",{model:{value:e.detail.allCanEdit,callback:function(t){e.$set(e.detail,"allCanEdit",t)},expression:"detail.allCanEdit"}},[e._v("可编辑")]),a("el-checkbox",{model:{value:e.detail.allCanUpload,callback:function(t){e.$set(e.detail,"allCanUpload",t)},expression:"detail.allCanUpload"}},[e._v("可上传")]),a("el-checkbox",{model:{value:e.detail.allCanView,callback:function(t){e.$set(e.detail,"allCanView",t)},expression:"detail.allCanView"}},[e._v("可查看")])],1)],1):e._e(),e.list[1].checked?a("div",[a("el-form-item",{attrs:{label:"可编辑人员（部门共享）",prop:"deptConfig.canEditIds"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择使用部门"},model:{value:e.detail.deptConfig.canEditIds,callback:function(t){e.$set(e.detail.deptConfig,"canEditIds",t)},expression:"detail.deptConfig.canEditIds"}},e._l(e.deptList,(function(t){return a("el-option",{key:t.deptId,attrs:{label:t.deptName,value:t.deptId}},[a("span",{style:{paddingLeft:10*t.level+"px"}},[e._v(e._s(t.deptName))])])})),1)],1),a("el-form-item",{attrs:{label:"可上传人员（部门共享）",prop:"deptConfig.canUploadIds"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择使用部门"},model:{value:e.detail.deptConfig.canUploadIds,callback:function(t){e.$set(e.detail.deptConfig,"canUploadIds",t)},expression:"detail.deptConfig.canUploadIds"}},e._l(e.deptList,(function(t){return a("el-option",{key:t.deptId,attrs:{label:t.deptName,value:t.deptId}},[a("span",{style:{paddingLeft:10*t.level+"px"}},[e._v(e._s(t.deptName))])])})),1)],1),a("el-form-item",{attrs:{label:"可查看人员（部门共享）",prop:"deptConfig.canViewIds"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择使用部门"},model:{value:e.detail.deptConfig.canViewIds,callback:function(t){e.$set(e.detail.deptConfig,"canViewIds",t)},expression:"detail.deptConfig.canViewIds"}},e._l(e.deptList,(function(t){return a("el-option",{key:t.deptId,attrs:{label:t.deptName,value:t.deptId}},[a("span",{style:{paddingLeft:10*t.level+"px"}},[e._v(e._s(t.deptName))])])})),1)],1)],1):e._e(),e.list[2].checked?a("div",[a("el-form-item",{attrs:{label:"可编辑人员（人员共享）",prop:"userConfig.canEditIds"}},[a("user-select",{attrs:{users:e.detail.userConfig.canEditIds},on:{SET_USERS:function(t){e.detail.userConfig.canEditIds=t}}})],1),a("el-form-item",{attrs:{label:"可上传人员（人员共享）",prop:"userConfig.canUploadIds"}},[a("user-select",{attrs:{users:e.detail.userConfig.canUploadIds},on:{SET_USERS:function(t){e.detail.userConfig.canUploadIds=t}}})],1),a("el-form-item",{attrs:{label:"可查看人员（人员共享）",prop:"userConfig.canViewIds"}},[a("user-select",{attrs:{users:e.detail.userConfig.canViewIds},on:{SET_USERS:function(t){e.detail.userConfig.canViewIds=t}}})],1)],1):e._e(),a("el-form-item",{attrs:{label:""}},[a("div",{staticClass:"w-100p",staticStyle:{"text-align":"left"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.save()}}},[e._v("确认")]),a("el-button",{attrs:{type:"default",size:"mini"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")])],1)])],1)],1)])],1)},n=[],s=(a("8dee"),a("1f6d")),l=a("cd05"),d=a("328f"),o={name:"",components:{userSelect:d["a"]},props:{item:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!1,deptList:[],list:[{name:"全局共享",value:"all",checked:!1},{name:"部门共享",value:"dept",checked:!1},{name:"人员共享",value:"user",checked:!1}],detail:{allCanEdit:!1,allCanUpload:!1,allCanView:!1,deptConfig:{canEditIds:[],canUploadIds:[],canViewIds:[]},userConfig:{canEditIds:[],canUploadIds:[],canViewIds:[]}}}},mounted:function(){this.getDeptTree()},methods:{showDialog:function(){var e=this;if(this.dialogVisible=!0,this.item.isShare){var t={typedId:this.item.typedId};s["a"].getShareDetail(t).then((function(t){if(200===t.code){for(var a in e.detail.allCanEdit=t.data.allCanEdit,e.detail.allCanUpload=t.data.allCanUpload,e.detail.allCanView=t.data.allCanView,(t.data.allCanEdit||t.data.allCanUpload||t.data.allCanView)&&(e.list[0].checked=!0),t.data.deptConfig){var i=a.replace(/Depts/,"Ids");for(var n in t.data.deptConfig[i]=t.data.deptConfig[a],delete t.data.deptConfig[a],t.data.deptConfig[i])t.data.deptConfig[i][n]=t.data.deptConfig[i][n].deptId,e.list[1].checked=!0}for(var s in e.detail.deptConfig=t.data.deptConfig,t.data.userConfig){var l=s.replace(/Users/,"Ids");for(var d in t.data.userConfig[l]=t.data.userConfig[s],delete t.data.userConfig[s],t.data.userConfig[l])e.list[2].checked=!0}e.detail.userConfig=t.data.userConfig}})).catch((function(e){console.log(e)}))}else this.list=[{name:"全局共享",value:"all",checked:!1},{name:"部门共享",value:"dept",checked:!1},{name:"人员共享",value:"user",checked:!1}],this.detail={allCanEdit:!1,allCanUpload:!1,allCanView:!1,deptConfig:{canEditIds:[],canUploadIds:[],canViewIds:[]},userConfig:{canEditIds:[],canUploadIds:[],canViewIds:[]}}},hideDialog:function(){this.dialogVisible=!1},getDeptTree:function(){var e=this,t={withEntRoot:!0};l["a"].deptTree(t).then((function(t){if(200===t.code){var a=function e(t,a){for(var i in t)t[i].level=a,t[i].subDepts&&(t[i].subDepts=e(t[i].subDepts,a+1));return t},i=a(t.data,0);e.deptList=e.setSelectDept(Object.assign([],i),0),console.log(e.deptList)}})).catch((function(e){console.log(e)}))},setSelectDept:function(e,t){var a=[];for(var i in e)a.push({deptName:e[i].deptName,deptId:e[i].deptId,level:t}),e[i].subDepts&&(e[i].subDepts=this.setSelectDept(e[i].subDepts,t+1)),a=a.concat(e[i].subDepts);return a},save:function(e){var t=this;e&&this.list.map((function(e){e.checked=!1}));var a={typedId:this.item.typedId};if(this.list[0].checked?(a.allCanEdit=this.detail.allCanEdit,a.allCanUpload=this.detail.allCanUpload,a.allCanView=this.detail.allCanView):(a.allCanEdit=!1,a.allCanUpload=!1,a.allCanView=!1),this.list[1].checked?a.deptConfig=this.detail.deptConfig:a.deptConfig={canEditIds:[],canUploadIds:[],canViewIds:[]},this.list[2].checked)for(var i in a.userConfig=this.detail.userConfig,a.userConfig)for(var n in a.userConfig[i])a.userConfig[i][n]=a.userConfig[i][n].id||a.userConfig[i][n].userId;else a.userConfig={canEditIds:[],canUploadIds:[],canViewIds:[]};s["a"].saveShare(a).then((function(e){200===e.code&&(t.$message.success({message:"操作成功！",duration:1500}),t.hideDialog(),t.$emit("REFRESH"))})).catch((function(e){console.log(e)}))}}},c=o,r=(a("7c91"),a("d3b3"),a("4ac2")),u=Object(r["a"])(c,i,n,!1,null,"39c0f724",null);t["default"]=u.exports},"20a3":function(e,t,a){},"328f":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"users-wrap"},[e._l(e.users,(function(t,i){return a("div",{key:i,staticClass:"avatar",class:{step:e.step,last:i===e.users.length-1}},[a("span",{staticClass:"close",on:{click:function(e){e.stopPropagation()}}},[a("i",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}],staticClass:"iconfont icon-guanbi",on:{click:function(t){return e.removeUser(i)}}})]),a("el-tooltip",{attrs:{content:t.userName,effect:"dark",placement:"top"}},[a("avatar",{attrs:{user:t}})],1),e.tags?a("div",{staticStyle:{"line-height":"16px","padding-top":"8px"}},[e._v(e._s(t.userTag||t.userName))]):e._e(),a("div",{staticClass:"line"})],1)})),a("div",{directives:[{name:"show",rawName:"v-show",value:e.edit,expression:"edit"}]},[a("i",{staticClass:"iconfont icon-tianjia pointer fs-22",on:{click:function(t){return e.showMemberTransfer("transfer")}}})]),a("members-transfer",{ref:"transfer",attrs:{multi:e.multi,role:e.role,step:e.step,users:e.users,invest:e.invest},on:{SAVE_USERS:e.setUsers}})],2)},n=[],s=a("7150"),l=a("8995"),d={components:{avatar:s["a"],membersTransfer:l["a"]},model:{prop:"users",event:"change"},props:{users:Array,step:{type:Boolean,default:function(){return!1}},edit:{type:Boolean,default:function(){return!0}},multi:{type:Boolean,default:function(){return!0}},placement:{type:String,default:function(){return"top"}},role:{type:Boolean,default:function(){return!1}},tags:{type:Boolean,default:function(){return!1}},invest:{type:Boolean,default:function(){return!1}}},computed:{},data:function(){return{}},methods:{setUsers:function(e){this.$emit("change",e),this.$emit("SET_USERS",e)},showMemberTransfer:function(e){this.$refs[""+e].show()},removeUser:function(e){var t=this.users;t.splice(e,1)}}},o=d,c=(a("44df"),a("4ac2")),r=Object(c["a"])(o,i,n,!1,null,"45d72c07",null);t["a"]=r.exports},"44df":function(e,t,a){"use strict";a("bfe1")},"7c91":function(e,t,a){"use strict";a("20a3")},bfe1:function(e,t,a){},cd05:function(e,t,a){"use strict";var i=a("b775");t["a"]={getEnum:function(e){return Object(i["a"])({url:"/enum/"+e,method:"get"})},deptTree:function(e){return Object(i["a"])({url:"/contacts/deptUserTree",method:"get",params:e})},getStatFinanceList:function(e){return Object(i["a"])({url:"/schedule/stat/cb/finance/list",method:"post",data:e})},updateStatFinanceList:function(e,t){return Object(i["a"])({url:"/schedule/stat/cb/finance/"+t+"/update",method:"post",data:e,headers:{"Content-Type":"application/json; charset=utf-8"}})},exportExcelCatering:function(e){return Object(i["a"])({url:"/schedule/stat/cb/finance/export",method:"get",params:e,responseType:"arraybuffer"})}}},d3b3:function(e,t,a){"use strict";a("dba4")},dba4:function(e,t,a){}}]);