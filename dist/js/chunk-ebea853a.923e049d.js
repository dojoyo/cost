(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ebea853a","chunk-0ef90e38","chunk-2d0e4a8c"],{"0291":function(t,e,a){},3087:function(t,e,a){"use strict";a("bca3")},4721:function(t,e,a){},"69af":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"tips-title"},[t._v("\n    "+t._s(t.title)+"\n  ")]),a("div",{staticClass:"form-content",staticStyle:{"margin-top":"15px"}},[a("el-form",{ref:"data",attrs:{model:t.data,"label-width":"0"}},[a("el-form-item",{attrs:{label:"",prop:"description"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:6},placeholder:""},model:{value:t.data.description,callback:function(e){t.$set(t.data,"description",e)},expression:"data.description"}})],1)],1)],1)])},o=[],n={name:"",components:{},props:{data:{type:Object,default:function(){return{}}},title:{type:String,default:function(){return"相关说明"}}},methods:{}},l=n,s=(a("3087"),a("4ac2")),r=Object(s["a"])(l,i,o,!1,null,"2f60d672",null);e["default"]=r.exports},"90ba":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,visible:t.dialogVisible,top:"50px",width:"500px"}},[a("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"title"},[t._v("驳回流程走向")]),a("div",{staticClass:"options"},[a("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:t.close}})]),a("div",{staticClass:"clear"})]),a("el-form",{attrs:{model:t.form,"label-position":"left","label-width":"85px"}},[a("el-form-item",{attrs:{label:"","label-width":"0"}},[a("el-radio-group",{model:{value:t.form.strategy,callback:function(e){t.$set(t.form,"strategy",e)},expression:"form.strategy"}},t._l(t.recallWays,(function(e){return a("el-radio",{key:e.name,attrs:{label:e.label}},[t._v(t._s(e.name))])})),1)],1),a("el-form-item",{attrs:{label:"","label-width":"0"}},[a("el-input",{attrs:{autosize:{minRows:4,maxRows:6},placeholder:"请填写审批意见(非必填)",type:"textarea"},model:{value:t.form.opinion,callback:function(e){t.$set(t.form,"opinion",e)},expression:"form.opinion"}})],1)],1),a("div",{staticClass:"w-100p txt-right",staticStyle:{"margin-top":"20px"}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.confirm}},[t._v("确定")])],1)],1)},o=[],n=(a("b429"),{name:"RecallDialog",props:{visible:{type:Boolean,default:!1},approvalId:{type:String,default:""},nodeInstanceId:{type:String,default:""}},computed:{dialogVisible:function(){return this.visible}},data:function(){return{recallWays:[{name:"回到原驳回人",label:"RN"},{name:"重新依次审批",label:"SN"}],form:{strategy:"RN",opinion:""}}},methods:{confirm:function(){this.$emit("confirm",this.form),this.close()},close:function(){this.$emit("update:visible",!1)}}}),l=n,s=a("4ac2"),r=Object(s["a"])(l,i,o,!1,null,null,null);e["default"]=r.exports},"9efb":function(t,e,a){"use strict";a("4721")},aba7:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{visible:t.dialogVisible,width:"850px","append-to-body":!0,"show-close":!1,top:"50px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"header",attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"title"},[a("i",{staticClass:"iconfont icon-xiangmuguanli"}),t._v(" "+t._s(t.detail.bizForm&&t.detail.bizForm.itemName||"签订投资协议")+"\n    ")]),a("div",{staticClass:"options",staticStyle:{display:"flex","align-items":"center"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.approveDetail.approvalId,expression:"!approveDetail.approvalId"}],attrs:{type:"default",size:"small"},on:{click:function(e){return t.submit("TS")}}},[t._v("暂存")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.approveDetail.approvalId,expression:"!approveDetail.approvalId"}],staticStyle:{"margin-right":"20px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.submit("CA")}}},[t._v("提交")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.approveDetail.approvalId,expression:"approveDetail.approvalId"}],staticStyle:{"margin-right":"20px"},attrs:{type:"primary",size:"small"},on:{click:function(e){t.submit(t.approveDetail.approvalState&&"DR"===t.approveDetail.approvalState.value?"CA":"RA")}}},[t._v("确认")]),a("i",{staticClass:"iconfont icon-guanbi pointer fs-22",on:{click:function(e){return t.hideDialog()}}})],1),a("div",{staticClass:"clear"})]),t.detail.bizForm?a("div",{staticClass:"main-wrap"},[a("el-scrollbar",{style:{height:t.height}},[a("el-form",{ref:"detail",attrs:{model:t.detail,"label-width":"140px"}},[a("div",{staticClass:"wrap"},[a("div",{staticClass:"center-title",staticStyle:{display:"flex","align-items":"center",padding:"0 15px 15px"}},[a("div",{staticStyle:{"word-break":"keep-all"}},[t._v("标题：")]),a("el-input",{attrs:{placeholder:""},model:{value:t.detail.approvalTitle,callback:function(e){t.$set(t.detail,"approvalTitle",e)},expression:"detail.approvalTitle"}})],1),a("div",{staticClass:"tips-title"},[t._v("基本信息")]),a("div",{staticStyle:{float:"left",width:"49%"}},[a("el-form-item",{attrs:{label:"项目名称"}},[t._v("\n            "+t._s(t.detail.bizForm.projectName)+"\n          ")]),"PM"===t.type||"SM"===t.type?a("el-form-item",{attrs:{label:"投资主体",prop:"bizForm.projectInvestor",rules:{required:!0,message:"请输入投资主体"}}},[a("el-input",{attrs:{placeholder:""},model:{value:t.detail.bizForm.projectInvestor,callback:function(e){t.$set(t.detail.bizForm,"projectInvestor",e)},expression:"detail.bizForm.projectInvestor"}})],1):t._e()],1),a("div",{staticStyle:{float:"left",width:"49%"}},[a("el-form-item",{attrs:{label:"项目类型"}},[t._v("\n            "+t._s(t.detail.bizForm.projectType&&t.detail.bizForm.projectType.name)+"\n          ")]),"PM"===t.type||"SM"===t.type?a("el-form-item",{attrs:{label:"股权占比",prop:"bizForm.shareRatio",rules:{required:!0,message:"请输入股权占比"}}},[a("el-input",{attrs:{placeholder:"",type:"number"},model:{value:t.detail.bizForm.shareRatio,callback:function(e){t.$set(t.detail.bizForm,"shareRatio",e)},expression:"detail.bizForm.shareRatio"}},[a("template",{slot:"append"},[t._v("%")])],2)],1):t._e()],1),a("div",{staticClass:"clear"})]),a("div",{staticClass:"wrap",staticStyle:{"margin-top":"15px"}},[a("div",{staticClass:"tips-title"},[t._v("\n            资金组成\n            "),a("el-button",{staticClass:"button",attrs:{type:"text"},on:{click:function(e){return t.addFundCompositions()}}},[a("i",{staticClass:"iconfont icon-xinjian"}),t._v(" 新增")])],1),t._l(t.detail.bizForm.fundCompositions,(function(e,i){return a("div",{key:i,staticClass:"form-content",staticStyle:{"margin-top":"15px",background:"#f7f7f7",padding:"15px 15px 15px 0"}},[a("div",{staticStyle:{float:"left",width:"49%","margin-left":"2%"}},[a("el-form-item",{attrs:{label:"资金来源",prop:"bizForm.fundCompositions["+i+"].fundSource",rules:{required:!0,message:"请选择资金来源"}}},[a("el-select",{style:{width:"FU"===e.fundSource?"45%":"100%"},attrs:{placeholder:""},model:{value:e.fundSource,callback:function(a){t.$set(e,"fundSource",a)},expression:"item.fundSource"}},t._l(t.enumType.ProjectFundSource,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})})),1),"FU"===e.fundSource?a("el-select",{staticStyle:{width:"45%","margin-left":"10%"},attrs:{placeholder:""},model:{value:e.fundId,callback:function(a){t.$set(e,"fundId",a)},expression:"item.fundId"}},t._l(t.funds,(function(t){return a("el-option",{key:t.fundId,attrs:{label:t.fundAbbr,value:t.fundId}})})),1):t._e()],1)],1),a("div",{staticStyle:{float:"left",width:"49%"}},[a("el-form-item",{attrs:{label:"投资金额",prop:"bizForm.fundCompositions["+i+"].investAmt",rules:{required:!0,message:"请输入投资金额"}}},[a("el-input",{attrs:{placeholder:"",type:"number"},model:{value:e.investAmt,callback:function(a){t.$set(e,"investAmt",a)},expression:"item.investAmt"}},[a("template",{slot:"append"},[t._v("万"+t._s(t._f("formatMoneyUnit")(t.detail.bizForm.projectCcy)))])],2)],1)],1),a("div",{staticClass:"clear"}),a("div",{staticStyle:{display:"flex"}},[a("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"text"},on:{click:function(e){return t.removeFundCompositions(i)}}},[a("i",{staticClass:"iconfont icon-delete"}),t._v(" 删除")])],1)])}))],2),a("div",{staticClass:"wrap"},[a("remark",{attrs:{data:t.detail.bizForm}})],1),a("div",{staticClass:"wrap"},[a("files",{attrs:{files:t.detail.bizForm.attaches},on:{UPLOAD_FILE:function(e){t.detail.bizForm.attaches=e}}})],1),a("div",{staticClass:"wrap"},[a("approve",{attrs:{data:t.detail},on:{SET_NODE_USERS:function(e){t.detail.approvalNodes=e},SET_CC_USERS:function(e){t.detail.ccUsers=e}}})],1)])],1)],1):t._e(),t.showInnerDialog?a("recall-dialog",{attrs:{visible:t.showInnerDialog},on:{"update:visible":function(e){t.showInnerDialog=e},confirm:function(e){return t.submit("RA",e)}}}):t._e()],1)},o=[],n=a("b62b"),l=a("90ba"),s=a("69af"),r=a("ff5a"),d=a("0a92"),p=a("ed08"),c={name:"",components:{RecallDialog:l["default"],remark:s["default"],files:r["default"],approve:d["default"]},props:{id:{type:String,default:function(){return""}},templateCode:{type:String,default:function(){return"DD03"}},draft:{type:Boolean,default:function(){return!1}}},data:function(){return{enumType:{},itemId:"",dialogVisible:!1,detail:{},height:"",type:"",approveDetail:"",showInnerDialog:!1,funds:[]}},mounted:function(){this.height=document.body.clientHeight-200+"px",this.getEnum("ProjectFundSource")},methods:{getEnum:function(t,e){var a=this;n["a"].getEnum(t).then((function(i){200===i.code&&(e&&i.data.unshift({name:"全部",value:""}),a.$set(a.enumType,t,i.data),"TermType"===t&&(a.curTermType=i.data))})).catch((function(t){console.log(t)}))},show:function(t){t.itemId?(this.itemId=t.itemId,t.completeStatus&&"DR"===t.completeStatus.value?this.initParamsByDraft(t):this.initParams(t)):(this.approveDetail=t,this.initParamsByBiz(t.bizForm.bizId)),this.getFundList()},hideDialog:function(){this.$refs["detail"].clearValidate(),this.dialogVisible=!1},initParams:function(t){var e=this,a={itemId:t.itemId,projectId:this.id,templateCode:t.templateCode};n["a"].initProjectApplyInit(a).then((function(t){if(200===t.code){var a=[];t.data.approvalNodes.map((function(t){t.nodeType&&"CN"!==t.nodeType.value&&a.push({userName:t.approvalUser&&t.approvalUser.userName||t.nodeName,nodeRefId:t.approvalUser&&t.approvalUser.userId,nodeId:t.nodeInstanceId,nodeType:t.nodeType&&t.nodeType.value,userId:t.nodeRefId||t.id,userTag:t.nodeName,nodeName:t.nodeName})})),t.data.approvalNodes=a,t.data.urgencyLvl=t.data.urgencyLvl.value,e.type=t.data.bizForm.projectInvestType.value,e.$emit("SET_APPROVAL",t.data),t.data.bizForm.fundCompositionDto.map((function(t){t.fundSource=t.fundSource.value})),t.data.bizForm.fundCompositions=t.data.bizForm.fundCompositionDto||[{fundSource:"",investAmt:"",fundId:""}],e.detail=t.data,e.dialogVisible=!0}})).catch((function(t){console.log(t)}))},initParamsByDraft:function(t){var e=this;n["a"].initProjectFormDraft(t.itemId).then((function(t){200===t.code&&e.formatData(t)})).catch((function(t){console.log(t)}))},initParamsByBiz:function(t){var e=this;n["a"].initProjectFormBiz(t).then((function(t){if(200===t.code){var a={data:{approvalTitle:e.approveDetail.approvalTitle,approvalId:e.approveDetail.approvalId,approvalNodes:e.approveDetail.approvalNodes,ccUsers:e.approveDetail.ccUsers,templateCode:e.approveDetail.templateCode,urgencyLvl:e.approveDetail.urgencyLvl,approvalType:e.approveDetail.approvalType,bizForm:t.data}};e.formatData(a)}})).catch((function(t){console.log(t)}))},formatData:function(t){var e=[];t.data.approvalNodes.map((function(t){t.nodeType&&"CN"!==t.nodeType.value&&e.push({userName:t.approvalUser&&t.approvalUser.userName||t.nodeName,nodeRefId:t.approvalUser&&t.approvalUser.userId,nodeId:t.nodeInstanceId,nodeType:t.nodeType&&t.nodeType.value,userId:t.nodeRefId||t.id,userTag:t.nodeName,nodeName:t.nodeName})})),t.data.approvalNodes=e,t.data.urgencyLvl=t.data.urgencyLvl.value,this.type=t.data.bizForm.projectInvestType.value,"MA"===this.type&&(t.data.bizForm.termMa=t.data.bizForm.termMa||{}),t.data.bizForm.fundCompositionDto.map((function(t){t.fundSource=t.fundSource.value})),t.data.bizForm.fundCompositions=t.data.bizForm.fundCompositionDto,this.detail=t.data,this.dialogVisible=!0},setApprovalNodes:function(t){for(var e in t)t[e].nodeRefId=t[e].nodeRefId||t[e].id||t[e].userId,t[e].nodeType=t[e].nodeType||"UN",t[e].userId=t[e].nodeRefId||t[e].id,t[e].userTag=t[e].userTag||"审批人",t[e].nodeName=t[e].userTag||"审批人";this.detail.approvalNodes=t},submit:function(t,e){var a=this;this.$refs["detail"].validate((function(i){if(i){if(a.detail.bizForm.fundCompositions=a.detail.bizForm.fundCompositions||[],a.detail.bizForm.fundCompositions.length<1)return void a.$message.warning({message:"资金组成中至少有一个资金来源！",duration:1500});var o=p["a"].deepCopy(a.detail),l={};l.submitType=t,l.templateCode=a.templateCode,l.urgencyLvl=o.urgencyLvl,o.approvalId&&(l.approvalId=o.approvalId),o.approvalTitle&&(l.approvalTitle=o.approvalTitle),o.approvalType&&"FX"!==o.approvalType.value&&(l.approvalNodes=o.approvalNodes,l.ccUserIds=function(){var t=[];return o.ccUsers.map((function(e){t.push(e.id||e.userId)})),t}()),o.bizForm.projectId=a.id||o.bizForm.projectId,o.bizForm.itemId=a.itemId||o.bizForm.itemId,delete o.bizForm.projectCcy,l.bizForm=o.bizForm,"RA"!==t||"RJ"!==a.approveDetail.currentNode.nodeState.value||e?"RA"===t&&"RJ"===a.approveDetail.currentNode.nodeState.value&&e?(l.resubmitOpt={nodeInstanceId:a.approveDetail.currentNode.nodeInstanceId,opinion:e.opinion,strategy:e.strategy},n["a"].createProjectForm(l).then((function(t){200===t.code&&(a.$message.success({message:"重新提交成功！",duration:1500}),a.$emit("REFRESH"),a.hideDialog())})).catch((function(t){console.log(t)}))):n["a"].createProjectForm(l).then((function(t){200===t.code&&(a.$message.success({message:"提交成功！",duration:1500}),a.$emit("REFRESH"),a.hideDialog())})).catch((function(t){console.log(t)})):a.showInnerDialog=!0}}))},getFundList:function(){var t=this;n["a"].getFundList().then((function(e){200===e.code&&(t.funds=e.data)})).catch((function(t){console.log(t)}))},addFundCompositions:function(){console.log(1),this.detail.bizForm.fundCompositions||this.$set(this.detail.bizForm,"fundCompositions",[]),console.log(2),this.detail.bizForm.fundCompositions.push({fundSource:"",investAmt:"",fundId:""})},removeFundCompositions:function(t){this.detail.bizForm.fundCompositions.splice(t,1)}}},u=c,m=(a("f024"),a("c1f7"),a("4ac2")),f=Object(m["a"])(u,i,o,!1,null,"0d331d6e",null);e["default"]=f.exports},bca3:function(t,e,a){},c1f7:function(t,e,a){"use strict";a("de22")},de22:function(t,e,a){},f024:function(t,e,a){"use strict";a("0291")},ff5a:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"tips-title"},[t._v("\n    "+t._s(t.title)+"\n    "),a("div",{staticClass:"button"},[a("file-upload",{attrs:{icon:"icon",files:t.files,list:!1,tag:"invest"},on:{UPLOAD_FILE:function(e){return t.$emit("UPLOAD_FILE",e)}}})],1)]),a("div",{staticClass:"form-content",staticStyle:{"margin-top":"15px"}},[a("file-upload",{attrs:{icon:"none",files:t.files}})],1)])},o=[],n=a("7218"),l={name:"",components:{fileUpload:n["a"]},props:{data:{type:Object,default:function(){return{}}},title:{type:String,default:function(){return"相关附件"}},files:{type:Array,default:function(){return[]}}}},s=l,r=(a("9efb"),a("4ac2")),d=Object(r["a"])(s,i,o,!1,null,"528bda6b",null);e["default"]=d.exports}}]);